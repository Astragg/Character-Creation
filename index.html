<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Aethelgard II: Rise of Kingdoms</title>
<style>
Â  Â  :root {
Â  Â  Â  Â  --bg: #121214;
Â  Â  Â  Â  --panel: rgba(20, 20, 25, 0.9);
Â  Â  Â  Â  --border: rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  --accent: #5e9cd1;
Â  Â  Â  Â  --text: #e0e0e0;
Â  Â  Â  Â  --gold: #ffd700;
Â  Â  Â  Â  --magic: #b388eb;
Â  Â  Â  Â  --crime: #ff4d4d;
Â  Â  }
Â  Â  body { margin: 0; overflow: hidden; background: var(--bg); font-family: 'Segoe UI', monospace; color: var(--text); user-select: none; }
Â  Â  canvas { display: block; width: 100vw; height: 100vh; cursor: crosshair; }
Â  Â Â 
Â  Â  /* UI Layout */
Â  Â  .ui-layer { position: absolute; pointer-events: none; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
Â  Â  .top-bar { top: 0; left: 0; right: 0; flex-direction: row; justify-content: space-between; pointer-events: auto; background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent); padding: 10px 20px; }
Â  Â  .bottom-bar { bottom: 0; left: 0; right: 0; pointer-events: auto; justify-content: center; align-items: center; padding-bottom: 20px; }
Â  Â  .panel { background: var(--panel); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 8px; padding: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); pointer-events: auto; }
Â  Â Â 
Â  Â  /* Stats */
Â  Â  .stat-group { display: flex; gap: 20px; font-size: 14px; font-weight: 600; text-shadow: 0 2px 4px black; }
Â  Â  .stat-item span { color: var(--accent); margin-left: 5px; }
Â  Â Â 
Â  Â  /* Inspector */
Â  Â  #inspector { top: 60px; left: 20px; width: 300px; max-height: 80vh; overflow-y: auto; display: none; font-size: 12px; }
Â  Â  .inspector-row { display: flex; justify-content: space-between; margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom:2px;}
Â  Â  .avatar { width: 45px; height: 45px; background: #222; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; margin-right: 10px; border: 2px solid var(--accent); position: relative;}
Â  Â  .header-row { display: flex; align-items: center; margin-bottom: 10px; }
Â  Â  h2 { margin: 0; font-size: 16px; color: var(--gold); }
Â  Â  h3 { margin: 0; font-size: 12px; color: #888; }
Â  Â Â 
Â  Â  /* Specialized Badges */
Â  Â  .trait-badge { display: inline-block; padding: 2px 6px; background: #333; border-radius: 4px; margin: 2px; font-size: 10px; border: 1px solid #555; }
Â  Â  .trait-magic { border-color: var(--magic); color: var(--magic); }
Â  Â  .trait-crime { border-color: var(--crime); color: var(--crime); }
Â  Â Â 
Â  Â  /* Controls */
Â  Â  .toolbar { display: flex; gap: 8px; background: var(--panel); padding: 8px 16px; border-radius: 50px; border: 1px solid var(--border); }
Â  Â  button { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text); padding: 6px 12px; border-radius: 4px; cursor: pointer; transition: all 0.2s; font-size: 12px; }
Â  Â  button:hover { background: rgba(255,255,255,0.15); }
Â  Â  button.active { background: var(--accent); color: #fff; border-color: transparent; }
Â  Â Â 
Â  Â  /* Toasts */
Â  Â  #toast-container { bottom: 100px; right: 20px; width: 320px; align-items: flex-end; pointer-events: none; }
Â  Â  .toast { background: rgba(0,0,0,0.9); border-left: 3px solid var(--accent); padding: 8px 12px; border-radius: 4px; margin-top: 6px; font-size: 11px; animation: fadeOut 6s forwards; pointer-events: auto; }
Â  Â  .toast.crime { border-color: var(--crime); }
Â  Â  .toast.magic { border-color: var(--magic); }
Â  Â Â 
Â  Â  @keyframes fadeOut { 0% { opacity:0; transform: translateX(20px); } 10% { opacity:1; transform: translateX(0); } 80% { opacity:1; } 100% { opacity: 0; display:none; } }
Â  Â Â 
Â  Â  /* Bars */
Â  Â  .bar-con { width: 100%; background: #333; height: 4px; margin: 2px 0; border-radius: 2px; overflow: hidden; }
Â  Â  .bar-fill { height: 100%; transition: width 0.5s; }
Â  Â  ::-webkit-scrollbar { width: 5px; }
Â  Â  ::-webkit-scrollbar-thumb { background: #444; }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div class="ui-layer top-bar">
Â  Â  <div class="stat-group">
Â  Â  Â  Â  <div class="stat-item">Year: <span id="ui-year">1</span></div>
Â  Â  Â  Â  <div class="stat-item">Pop: <span id="ui-pop">0</span></div>
Â  Â  Â  Â  <div class="stat-item">Avg Crime: <span id="ui-crime">0%</span></div>
Â  Â  </div>
Â  Â  <div class="toolbar">
Â  Â  Â  Â  <button onclick="game.speed=0">â¸ï¸</button>
Â  Â  Â  Â  <button onclick="game.speed=1" class="active" id="spd-1">â–¶ï¸</button>
Â  Â  Â  Â  <button onclick="game.speed=10" id="spd-10">â©</button>
Â  Â  </div>
</div>

<div id="inspector" class="ui-layer panel"></div>

<div class="ui-layer bottom-bar">
Â  Â  <div class="toolbar">
Â  Â  Â  Â  <button onclick="ui.setTool('select')" id="btn-select" class="active">ğŸ‘† Inspect</button>
Â  Â  Â  Â  <button onclick="ui.setTool('drag')" id="btn-drag">âœ‹ Pan</button>
Â  Â  Â  Â  <div style="width:1px; background:#444; margin:0 4px;"></div>
Â  Â  Â  Â  <button onclick="ui.setTool('god_bless')" style="color:var(--gold)">âœ¨ Bless</button>
Â  Â  Â  Â  <button onclick="ui.setTool('god_smite')" style="color:var(--crime)">âš¡ Smite</button>
Â  Â  Â  Â  <button onclick="ui.setTool('spawn_plague')" style="color:lime">â˜£ï¸ Plague</button>
Â  Â  </div>
</div>

<div id="toast-container" class="ui-layer"></div>

<script>
/** --- CONFIGURATION --- */
const CFG = {
Â  Â  w: 150, h: 150, // Smaller map for density
Â  Â  tileSize: 32,
Â  Â  tickRate: 30,
Â  Â  dayTicks: 50,
Â  Â  yearDays: 120, // Short years for generational speed
Â  Â  startCities: 3
};

/** --- DATA & ASSETS --- */
const TILES = { WATER: 0, GRASS: 1, FOREST: 2, MOUNTAIN: 3, CITY: 4 };
const PALETTE = { 0: '#4173a3', 1: '#5c9e63', 2: '#3a7042', 3: '#7a7a7a', 4: '#333' };

const RACES = {
Â  Â  HUMAN: { name: 'Human', emoji: 'ğŸ§‘', life: 65, traits: ['Ambitious'], baseStats: {agg: 40, grd: 50, loy: 50} },
Â  Â  ELF: { name: 'Elf', emoji: 'ğŸ§', life: 180, traits: ['Arcane'], baseStats: {agg: 10, grd: 20, loy: 80} },
Â  Â  ORC: { name: 'Orc', emoji: 'ğŸ‘¹', life: 50, traits: ['Strong'], baseStats: {agg: 80, grd: 60, loy: 30} },
Â  Â  DWARF: { name: 'Dwarf', emoji: 'ğŸ§”', life: 90, traits: ['Sturdy'], baseStats: {agg: 40, grd: 80, loy: 70} }
};

const JOBS = {
Â  Â  IDLE: 'Vagrant', CHILD: 'Child', FARMER: 'Farmer', GUARD: 'Guard',Â 
Â  Â  MAGE: 'Mage', THIEF: 'Thief', KING: 'Ruler', PRISONER: 'Prisoner'
};

const GENETIC_TRAITS = {
Â  Â  STRONG: { name: 'Strong', stat: 'str', mod: 20 },
Â  Â  GENIUS: { name: 'Genius', stat: 'int', mod: 20 },
Â  Â  ARCANE: { name: 'Arcane', stat: 'manaMax', mod: 50 }, // Enables Magic
Â  Â  VIOLENT: { name: 'Violent', stat: 'agg', mod: 30 }, // Hereditary aggression
Â  Â  CHARMING: { name: 'Charming', stat: 'cha', mod: 20 },
Â  Â  SICKLY: { name: 'Sickly', stat: 'str', mod: -10 }
};

const SPELLS = {
Â  Â  FIREBALL: { cost: 30, combat: true },
Â  Â  BLOOM: { cost: 20, combat: false }, // Grows food
Â  Â  HEAL: { cost: 40, combat: false }
};

/** --- UTILS --- */
const rand = (n) => Math.floor(Math.random() * n);
const pick = (arr) => arr[rand(arr.length)];
const dist = (a, b) => Math.sqrt((a.x-b.x)**2 + (a.y-b.y)**2);
const uuid = () => Math.random().toString(36).substr(2, 9);
const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

/** --- ENGINE --- */
class Game {
Â  Â  constructor() {
Â  Â  Â  Â  this.canvas = document.getElementById('gameCanvas');
Â  Â  Â  Â  this.ctx = this.canvas.getContext('2d');
Â  Â  Â  Â  this.width = window.innerWidth;
Â  Â  Â  Â  this.height = window.innerHeight;
Â  Â  Â  Â  this.canvas.width = this.width;
Â  Â  Â  Â  this.canvas.height = this.height;
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.ticks = 0;
Â  Â  Â  Â  this.speed = 1;
Â  Â  Â  Â  this.camera = { x: 0, y: 0, z: 1.5, drag: false, lx: 0, ly: 0 };
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.map = [];
Â  Â  Â  Â  this.cities = [];
Â  Â  Â  Â  this.units = [];
Â  Â  Â  Â  this.particles = [];
Â  Â  Â  Â  this.year = 1;
Â  Â  Â  Â  this.day = 0;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Input
Â  Â  Â  Â  this.canvas.onmousedown = e => {
Â  Â  Â  Â  Â  Â  if(ui.tool === 'drag') { this.camera.drag = true; this.camera.lx = e.clientX; this.camera.ly = e.clientY; }
Â  Â  Â  Â  Â  Â  else this.click(e);
Â  Â  Â  Â  };
Â  Â  Â  Â  window.onmousemove = e => {
Â  Â  Â  Â  Â  Â  if(this.camera.drag) {
Â  Â  Â  Â  Â  Â  Â  Â  this.camera.x -= (e.clientX - this.camera.lx) / this.camera.z;
Â  Â  Â  Â  Â  Â  Â  Â  this.camera.y -= (e.clientY - this.camera.ly) / this.camera.z;
Â  Â  Â  Â  Â  Â  Â  Â  this.camera.lx = e.clientX; this.camera.ly = e.clientY;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  window.onmouseup = () => this.camera.drag = false;
Â  Â  Â  Â  window.onwheel = e => this.camera.z = clamp(this.camera.z - Math.sign(e.deltaY)*0.1, 0.5, 4);
Â  Â  }

Â  Â  init() {
Â  Â  Â  Â  // Gen Map
Â  Â  Â  Â  for(let y=0; y<CFG.h; y++) {
Â  Â  Â  Â  Â  Â  let row = [];
Â  Â  Â  Â  Â  Â  for(let x=0; x<CFG.w; x++) {
Â  Â  Â  Â  Â  Â  Â  Â  let n = Math.sin(x*0.1) + Math.cos(y*0.1) + Math.random()*0.2;
Â  Â  Â  Â  Â  Â  Â  Â  row.push(n < -0.5 ? TILES.WATER : (n > 1.2 ? TILES.MOUNTAIN : (n > 0.8 ? TILES.FOREST : TILES.GRASS)));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  this.map.push(row);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Gen Civs
Â  Â  Â  Â  const races = Object.values(RACES);
Â  Â  Â  Â  for(let i=0; i<CFG.startCities; i++) {
Â  Â  Â  Â  Â  Â  let rx = rand(CFG.w), ry = rand(CFG.h);
Â  Â  Â  Â  Â  Â  if(this.map[ry][rx] !== TILES.WATER) {
Â  Â  Â  Â  Â  Â  Â  Â  this.createCity(rx, ry, races[i%races.length], i===0);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.loop();
Â  Â  }

Â  Â  createCity(x, y, race, isCapital) {
Â  Â  Â  Â  const c = new City(x, y, race);
Â  Â  Â  Â  if(isCapital) c.isCapital = true;
Â  Â  Â  Â  this.cities.push(c);
Â  Â  Â  Â  // Initial Pop
Â  Â  Â  Â  for(let k=0; k<6; k++) this.spawnUnit(x, y, race, c);
Â  Â  Â  Â  ui.toast(`${c.name} founded. ${isCapital ? 'CAPITAL' : ''}`);
Â  Â  }

Â  Â  spawnUnit(x, y, race, city, parents=null) {
Â  Â  Â  Â  const u = new Unit(x, y, race, parents);
Â  Â  Â  Â  u.city = city;
Â  Â  Â  Â  city.pop.push(u);
Â  Â  Â  Â  this.units.push(u);
Â  Â  Â  Â  return u;
Â  Â  }

Â  Â  click(e) {
Â  Â  Â  Â  const rect = this.canvas.getBoundingClientRect();
Â  Â  Â  Â  const wx = (e.clientX - rect.left)/this.camera.z + this.camera.x;
Â  Â  Â  Â  const wy = (e.clientY - rect.top)/this.camera.z + this.camera.y;
Â  Â  Â  Â  const tx = Math.floor(wx/CFG.tileSize);
Â  Â  Â  Â  const ty = Math.floor(wy/CFG.tileSize);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(ui.tool === 'select') {
Â  Â  Â  Â  Â  Â  // Find unit
Â  Â  Â  Â  Â  Â  const u = this.units.find(u => Math.abs(u.x - tx) < 1 && Math.abs(u.y - ty) < 1);
Â  Â  Â  Â  Â  Â  if(u) { ui.select(u); return; }
Â  Â  Â  Â  Â  Â  // Find City
Â  Â  Â  Â  Â  Â  const c = this.cities.find(c => Math.abs(c.x - tx) < 2 && Math.abs(c.y - ty) < 2);
Â  Â  Â  Â  Â  Â  if(c) { ui.select(c); return; }
Â  Â  Â  Â  Â  Â  ui.select(null);
Â  Â  Â  Â  } else if (ui.tool === 'god_smite') {
Â  Â  Â  Â  Â  Â  const u = this.units.find(u => Math.abs(u.x - tx) < 1);
Â  Â  Â  Â  Â  Â  if(u) u.die('Divine Smite');
Â  Â  Â  Â  } else if (ui.tool === 'spawn_plague') {
Â  Â  Â  Â  Â  Â  const c = this.cities.find(c => Math.abs(c.x - tx) < 5);
Â  Â  Â  Â  Â  Â  if(c) {
Â  Â  Â  Â  Â  Â  Â  Â  c.pop.forEach(p => { if(Math.random()<0.5) p.health = 10; });
Â  Â  Â  Â  Â  Â  Â  Â  ui.toast(`Plague strikes ${c.name}!`, 'crime');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  loop() {
Â  Â  Â  Â  requestAnimationFrame(() => this.loop());
Â  Â  Â  Â  if(this.speed === 0) return;

Â  Â  Â  Â  for(let s=0; s<this.speed; s++) {
Â  Â  Â  Â  Â  Â  this.ticks++;
Â  Â  Â  Â  Â  Â  if(this.ticks % CFG.dayTicks === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  this.day++;
Â  Â  Â  Â  Â  Â  Â  Â  if(this.day > CFG.yearDays) { this.day=0; this.year++; ui.toast(`Year ${this.year}`); }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  this.cities.forEach(c => c.update());
Â  Â  Â  Â  Â  Â  this.units.forEach(u => u.update());
Â  Â  Â  Â  Â  Â  this.units = this.units.filter(u => !u.dead); // Cleanup

Â  Â  Â  Â  Â  Â  // Particles
Â  Â  Â  Â  Â  Â  this.particles.forEach(p => { p.y+=p.vy; p.life--; });
Â  Â  Â  Â  Â  Â  this.particles = this.particles.filter(p => p.life > 0);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(this.ticks % 30 === 0) ui.update();
Â  Â  Â  Â  }
Â  Â  Â  Â  this.render();
Â  Â  }

Â  Â  render() {
Â  Â  Â  Â  const c = this.ctx;
Â  Â  Â  Â  const ts = CFG.tileSize;
Â  Â  Â  Â  c.fillStyle = '#121214'; c.fillRect(0,0,this.width,this.height);
Â  Â  Â  Â  c.save();
Â  Â  Â  Â  c.scale(this.camera.z, this.camera.z);
Â  Â  Â  Â  c.translate(-this.camera.x, -this.camera.y);

Â  Â  Â  Â  // Map
Â  Â  Â  Â  const vx = Math.floor(this.camera.x/ts), vy = Math.floor(this.camera.y/ts);
Â  Â  Â  Â  const vw = this.width/this.camera.z/ts + 2, vh = this.height/this.camera.z/ts + 2;
Â  Â  Â  Â Â 
Â  Â  Â  Â  for(let y=Math.max(0,vy); y<Math.min(CFG.h, vy+vh); y++) {
Â  Â  Â  Â  Â  Â  for(let x=Math.max(0,vx); x<Math.min(CFG.w, vx+vw); x++) {
Â  Â  Â  Â  Â  Â  Â  Â  c.fillStyle = PALETTE[this.map[y][x]];
Â  Â  Â  Â  Â  Â  Â  Â  c.fillRect(x*ts, y*ts, ts, ts);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Cities
Â  Â  Â  Â  this.cities.forEach(city => {
Â  Â  Â  Â  Â  Â  c.fillStyle = 'rgba(0,0,0,0.5)';
Â  Â  Â  Â  Â  Â  c.fillRect(city.x*ts-ts, city.y*ts-ts, ts*3, ts*3);
Â  Â  Â  Â  Â  Â  c.textAlign='center';
Â  Â  Â  Â  Â  Â  c.font = '20px Arial';
Â  Â  Â  Â  Â  Â  c.fillText(city.isCapital ? 'ğŸ°' : 'ğŸ˜ï¸', city.x*ts + ts/2, city.y*ts + ts/2);
Â  Â  Â  Â  Â  Â  c.fillStyle='#fff'; c.font='10px Arial';
Â  Â  Â  Â  Â  Â  c.fillText(city.name, city.x*ts+ts/2, city.y*ts+ts*2);
Â  Â  Â  Â  });

Â  Â  Â  Â  // Units
Â  Â  Â  Â  this.units.forEach(u => {
Â  Â  Â  Â  Â  Â  if(u.x < vx || u.x > vx+vw || u.y < vy || u.y > vy+vh) return;
Â  Â  Â  Â  Â  Â  let px = u.x*ts, py = u.y*ts;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Selection
Â  Â  Â  Â  Â  Â  if(ui.selected === u) { c.strokeStyle='#fff'; c.lineWidth=1; c.strokeRect(px, py, ts, ts); }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  c.font = `${ts*0.7}px Arial`;
Â  Â  Â  Â  Â  Â  c.textAlign = 'center';
Â  Â  Â  Â  Â  Â  let icon = u.emoji;
Â  Â  Â  Â  Â  Â  if(u.job === JOBS.KING) icon = 'ğŸ‘‘';
Â  Â  Â  Â  Â  Â  else if(u.job === JOBS.PRISONER) icon = 'â›“ï¸';
Â  Â  Â  Â  Â  Â  else if(u.dead) icon = 'ğŸ’€';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  c.fillText(icon, px+ts/2, py+ts*0.8);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Effect Indicators
Â  Â  Â  Â  Â  Â  if(u.state === 'MAGIC') { c.fillStyle= '#b388eb'; c.fillRect(px, py, ts, 2); }
Â  Â  Â  Â  Â  Â  if(u.crime > 50) { c.fillStyle='red'; c.fillText('!', px+ts, py); }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Particles
Â  Â  Â  Â  this.particles.forEach(p => {
Â  Â  Â  Â  Â  Â  c.globalAlpha = p.life/30;
Â  Â  Â  Â  Â  Â  c.fillStyle = p.color;
Â  Â  Â  Â  Â  Â  c.font = '12px Arial';
Â  Â  Â  Â  Â  Â  c.fillText(p.txt, p.x*ts, p.y*ts);
Â  Â  Â  Â  });
Â  Â  Â  Â  c.globalAlpha = 1;
Â  Â  Â  Â  c.restore();
Â  Â  }
Â  Â Â 
Â  Â  addParticle(x, y, txt, color='#fff') {
Â  Â  Â  Â  this.particles.push({x, y, txt, color, life:30, vy: -0.02});
Â  Â  }
}

/** --- LOGIC CLASSES --- */
class City {
Â  Â  constructor(x, y, race) {
Â  Â  Â  Â  this.name = race.name + 'ia ' + rand(99);
Â  Â  Â  Â  this.x = x; this.y = y;
Â  Â  Â  Â  this.race = race;
Â  Â  Â  Â  this.pop = [];
Â  Â  Â  Â  this.resources = { food: 200, gold: 100 };
Â  Â  Â  Â  this.ruler = null;
Â  Â  Â  Â  this.isCapital = false;
Â  Â  Â  Â  this.jail = [];
Â  Â  }

Â  Â  update() {
Â  Â  Â  Â  // Resources
Â  Â  Â  Â  this.resources.food += this.pop.filter(u=>u.job===JOBS.FARMER).length * 0.8;
Â  Â  Â  Â  this.resources.gold += this.pop.filter(u=>u.job!==JOBS.PRISONER).length * 0.1; // Tax
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Consumption
Â  Â  Â  Â  if(game.ticks % 100 === 0) {
Â  Â  Â  Â  Â  Â  this.resources.food -= this.pop.length * 1.0;
Â  Â  Â  Â  Â  Â  if(this.resources.food < 0) {
Â  Â  Â  Â  Â  Â  Â  Â  this.resources.food = 0;
Â  Â  Â  Â  Â  Â  Â  Â  // Starvation
Â  Â  Â  Â  Â  Â  Â  Â  if(Math.random() < 0.2) pick(this.pop).die('Starvation');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Politics
Â  Â  Â  Â  if(!this.ruler || this.ruler.dead) {
Â  Â  Â  Â  Â  Â  // Elect highest Influence (Charisma + Age)
Â  Â  Â  Â  Â  Â  const candidates = this.pop.filter(u => u.age > 18 && u.job !== JOBS.PRISONER);
Â  Â  Â  Â  Â  Â  if(candidates.length) {
Â  Â  Â  Â  Â  Â  Â  Â  candidates.sort((a,b) => (b.stats.cha + b.age) - (a.stats.cha + a.age));
Â  Â  Â  Â  Â  Â  Â  Â  this.ruler = candidates[0];
Â  Â  Â  Â  Â  Â  Â  Â  this.ruler.job = JOBS.KING;
Â  Â  Â  Â  Â  Â  Â  Â  this.ruler.journal.push(`Crowned Ruler of ${this.name}`);
Â  Â  Â  Â  Â  Â  Â  Â  ui.toast(`${this.ruler.name} is the new Ruler of ${this.name}`, 'gold');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
}

class Unit {
Â  Â  constructor(x, y, race, parents) {
Â  Â  Â  Â  this.id = uuid();
Â  Â  Â  Â  this.name = this.genName();
Â  Â  Â  Â  this.x = x; this.y = y;
Â  Â  Â  Â  this.race = race;
Â  Â  Â  Â  this.emoji = race.emoji;
Â  Â  Â  Â  this.age = parents ? 0 : 18 + rand(20);
Â  Â  Â  Â  this.maxAge = race.life + rand(10);
Â  Â  Â  Â  this.health = 100;
Â  Â  Â  Â  this.city = null;
Â  Â  Â  Â  this.job = parents ? JOBS.CHILD : JOBS.IDLE;
Â  Â  Â  Â  this.partner = null;
Â  Â  Â  Â  this.children = 0;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Stats & Genetics
Â  Â  Â  Â  this.stats = { str: 10, int: 10, cha: 10 };
Â  Â  Â  Â  this.traits = [];
Â  Â  Â  Â  this.mixGenetics(parents, race);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Personality (0-100)
Â  Â  Â  Â  this.personality = {
Â  Â  Â  Â  Â  Â  agg: clamp(race.baseStats.agg + rand(20)-10 + (this.hasTrait('Violent')?30:0), 0, 100),
Â  Â  Â  Â  Â  Â  grd: clamp(race.baseStats.grd + rand(20)-10, 0, 100),
Â  Â  Â  Â  Â  Â  loy: clamp(race.baseStats.loy + rand(20)-10, 0, 100)
Â  Â  Â  Â  };

Â  Â  Â  Â  // Advanced Stats
Â  Â  Â  Â  this.crime = 0; // Crime Score
Â  Â  Â  Â  this.mana = 0;
Â  Â  Â  Â  this.maxMana = this.hasTrait('Arcane') ? 100 : 0;

Â  Â  Â  Â  this.state = 'IDLE';
Â  Â  Â  Â  this.target = null;
Â  Â  Â  Â  this.journal = [];
Â  Â  }
Â  Â Â 
Â  Â  genName() {
Â  Â  Â  Â  const syl = ['Ar', 'Bor', 'Cal', 'Dan', 'El', 'Fin', 'Gor', 'Hul'];
Â  Â  Â  Â  const end = ['a', 'on', 'us', 'ix', 'or', 'ia', 'et'];
Â  Â  Â  Â  return pick(syl) + pick(end);
Â  Â  }

Â  Â  hasTrait(name) { return this.traits.some(t => t.name === name); }

Â  Â  mixGenetics(parents, race) {
Â  Â  Â  Â  // Base stats from Race
Â  Â  Â  Â  this.stats.str += rand(10);
Â  Â  Â  Â  this.stats.int += rand(10);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(parents) {
Â  Â  Â  Â  Â  Â  const [p1, p2] = parents;
Â  Â  Â  Â  Â  Â  // Inherit Traits (50% chance from each parent)
Â  Â  Â  Â  Â  Â  const pool = [...p1.traits, ...p2.traits];
Â  Â  Â  Â  Â  Â  pool.forEach(t => { if(Math.random() < 0.5 && !this.hasTrait(t.name)) this.traits.push(t); });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Mutation (5%)
Â  Â  Â  Â  Â  Â  if(Math.random() < 0.05) {
Â  Â  Â  Â  Â  Â  Â  Â  const mut = pick(Object.values(GENETIC_TRAITS));
Â  Â  Â  Â  Â  Â  Â  Â  if(!this.hasTrait(mut.name)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.traits.push(mut);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.journal.push(`Born with mutation: ${mut.name}`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Initial Gen Traits
Â  Â  Â  Â  Â  Â  if(Math.random() < 0.3) this.traits.push(pick(Object.values(GENETIC_TRAITS)));
Â  Â  Â  Â  }

Â  Â  Â  Â  // Apply Trait Mods
Â  Â  Â  Â  this.traits.forEach(t => {
Â  Â  Â  Â  Â  Â  if(t.stat === 'manaMax') this.maxMana = 100;
Â  Â  Â  Â  Â  Â  else if(this.stats[t.stat] !== undefined) this.stats[t.stat] += t.mod;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  update() {
Â  Â  Â  Â  if(this.dead) return;

Â  Â  Â  Â  // 1. Aging & Mana
Â  Â  Â  Â  if(game.ticks % 100 === 0) {
Â  Â  Â  Â  Â  Â  this.age += 0.1;
Â  Â  Â  Â  Â  Â  if(this.age > this.maxAge) this.die('Old Age');
Â  Â  Â  Â  Â  Â  if(this.maxMana > 0 && this.mana < this.maxMana) this.mana += 5;
Â  Â  Â  Â  }

Â  Â  Â  Â  // 2. Prison Logic
Â  Â  Â  Â  if(this.job === JOBS.PRISONER) {
Â  Â  Â  Â  Â  Â  // Chance to escape or die
Â  Â  Â  Â  Â  Â  if(Math.random() < 0.001) {
Â  Â  Â  Â  Â  Â  Â  Â  Â if(this.stats.str > 50) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.job = JOBS.IDLE;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.crime += 20;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.journal.push('Escaped Prison');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ui.toast(`${this.name} escaped jail!`, 'crime');
Â  Â  Â  Â  Â  Â  Â  Â  Â } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.die('Rotting in cell');
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return; // Can't do anything else
Â  Â  Â  Â  }

Â  Â  Â  Â  // 3. Decision Making
Â  Â  Â  Â  if(this.state === 'IDLE') this.decide();
Â  Â  Â  Â  else this.act();
Â  Â  }

Â  Â  decide() {
Â  Â  Â  Â  // A. CRIME CHECK
Â  Â  Â  Â  // High Greed + Low Loyalty or High Aggression
Â  Â  Â  Â  if (this.crime < 100 && Math.random() < 0.01) {
Â  Â  Â  Â  Â  Â  if (this.personality.grd > 75 && this.personality.loy < 40) {
Â  Â  Â  Â  Â  Â  Â  Â  this.state = 'CRIME_THEFT';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (this.personality.agg > 80 && Math.random() < 0.3) {
Â  Â  Â  Â  Â  Â  Â  Â  this.state = 'CRIME_VIOLENCE';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // B. JOB ASSIGNMENT (Simplified)
Â  Â  Â  Â  if(this.job === JOBS.CHILD && this.age >= 18) this.job = JOBS.IDLE;
Â  Â  Â  Â  if(this.job === JOBS.IDLE && this.city) {
Â  Â  Â  Â  Â  Â  if(this.hasTrait('Arcane')) this.job = JOBS.MAGE;
Â  Â  Â  Â  Â  Â  else if(this.stats.str > 30) this.job = JOBS.GUARD;
Â  Â  Â  Â  Â  Â  else this.job = JOBS.FARMER;
Â  Â  Â  Â  }

Â  Â  Â  Â  // C. MAGIC
Â  Â  Â  Â  if(this.job === JOBS.MAGE && this.mana >= 30 && Math.random() < 0.05) {
Â  Â  Â  Â  Â  Â  this.state = 'MAGIC';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // D. REPRODUCTION (Strict Controls)
Â  Â  Â  Â  // Needs: Age 18-50, Partner, Resources, Low random chance
Â  Â  Â  Â  if(this.age > 18 && this.age < 50 && this.partner && Math.random() < 0.001) { // significantly lowered
Â  Â  Â  Â  Â  Â  Â if(this.city.resources.food > 50 && this.children < 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â this.haveChild();
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  }

Â  Â  Â  Â  // E. ROMANCE (Lowered)
Â  Â  Â  Â  if(this.age > 18 && !this.partner && Math.random() < 0.005) {
Â  Â  Â  Â  Â  Â  const p = this.city.pop.find(u => u!==this && !u.partner && u.age > 18);
Â  Â  Â  Â  Â  Â  if(p) {
Â  Â  Â  Â  Â  Â  Â  Â  this.partner = p; p.partner = this;
Â  Â  Â  Â  Â  Â  Â  Â  this.journal.push(`Married ${p.name}`);
Â  Â  Â  Â  Â  Â  Â  Â  game.addParticle(this.x, this.y, 'â¤ï¸', 'pink');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // F. AFFAIR (Rare, High Greed/Lust logic)
Â  Â  Â  Â  if(this.partner && this.personality.loy < 20 && Math.random() < 0.00005) {
Â  Â  Â  Â  Â  Â  Â this.journal.push('Had an affair');
Â  Â  Â  Â  Â  Â  Â this.partner.journal.push(`Partner ${this.name} cheated`);
Â  Â  Â  Â  Â  Â  Â if(this.partner.personality.agg > 60) {
Â  Â  Â  Â  Â  Â  Â  Â  Â this.partner.state = 'CRIME_VIOLENCE'; // Crime of passion
Â  Â  Â  Â  Â  Â  Â  Â  Â this.partner.target = this;
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â this.partner.partner = null;Â 
Â  Â  Â  Â  Â  Â  Â this.partner = null;
Â  Â  Â  Â  Â  Â  Â ui.toast(`${this.name} had a scandalous affair!`, 'crime');
Â  Â  Â  Â  }

Â  Â  Â  Â  // Wander
Â  Â  Â  Â  let tx = this.x + (Math.random()-0.5)*4;
Â  Â  Â  Â  let ty = this.y + (Math.random()-0.5)*4;
Â  Â  Â  Â  this.target = {x:tx, y:ty};
Â  Â  Â  Â  this.state = 'MOVE';
Â  Â  }

Â  Â  act() {
Â  Â  Â  Â  if(this.state === 'MOVE' && this.target) {
Â  Â  Â  Â  Â  Â  const d = dist(this, this.target);
Â  Â  Â  Â  Â  Â  if(d < 0.5) this.state = 'IDLE';
Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  this.x += (this.target.x - this.x)/d * 0.1;
Â  Â  Â  Â  Â  Â  Â  Â  this.y += (this.target.y - this.y)/d * 0.1;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  else if(this.state === 'CRIME_THEFT') {
Â  Â  Â  Â  Â  Â  // Steal from city
Â  Â  Â  Â  Â  Â  if(this.city) {
Â  Â  Â  Â  Â  Â  Â  Â  this.city.resources.gold = Math.max(0, this.city.resources.gold - 10);
Â  Â  Â  Â  Â  Â  Â  Â  this.crime += 15;
Â  Â  Â  Â  Â  Â  Â  Â  this.journal.push('Stole gold from city');
Â  Â  Â  Â  Â  Â  Â  Â  game.addParticle(this.x, this.y, 'ğŸ’°', 'gold');
Â  Â  Â  Â  Â  Â  Â  Â  this.checkForGuards();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  this.state = 'IDLE';
Â  Â  Â  Â  }

Â  Â  Â  Â  else if (this.state === 'CRIME_VIOLENCE') {
Â  Â  Â  Â  Â  Â  const victim = this.city ? pick(this.city.pop) : null;
Â  Â  Â  Â  Â  Â  if(victim && victim !== this) {
Â  Â  Â  Â  Â  Â  Â  Â  victim.health -= 40;
Â  Â  Â  Â  Â  Â  Â  Â  this.crime += 50;
Â  Â  Â  Â  Â  Â  Â  Â  game.addParticle(victim.x, victim.y, 'ğŸ©¸', 'red');
Â  Â  Â  Â  Â  Â  Â  Â  this.journal.push(`Attacked ${victim.name}`);
Â  Â  Â  Â  Â  Â  Â  Â  if(victim.health <= 0) victim.die(`Murdered by ${this.name}`);
Â  Â  Â  Â  Â  Â  Â  Â  this.checkForGuards();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  this.state = 'IDLE';
Â  Â  Â  Â  }

Â  Â  Â  Â  else if (this.state === 'MAGIC') {
Â  Â  Â  Â  Â  Â  this.mana -= 30;
Â  Â  Â  Â  Â  Â  game.addParticle(this.x, this.y, 'âœ¨', '#b388eb');
Â  Â  Â  Â  Â  Â  // Effect: Grow food
Â  Â  Â  Â  Â  Â  if(this.city) {
Â  Â  Â  Â  Â  Â  Â  Â  this.city.resources.food += 20;
Â  Â  Â  Â  Â  Â  Â  Â  ui.toast(`${this.name} cast Bloom!`, 'magic');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  this.state = 'IDLE';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  checkForGuards() {
Â  Â  Â  Â  // If caught (random + crime score)
Â  Â  Â  Â  if(Math.random() * 100 < this.crime && this.city) {
Â  Â  Â  Â  Â  Â  const guards = this.city.pop.filter(u => u.job === JOBS.GUARD);
Â  Â  Â  Â  Â  Â  if(guards.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  if(this.crime > 80) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Capital Punishment
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.die('Executed by Guards');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ui.toast(`${this.name} executed for crimes.`, 'crime');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Jail
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.job = JOBS.PRISONER;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.journal.push('Arrested');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.addParticle(this.x, this.y, 'â›“ï¸', '#ccc');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.crime = 0; // Reset after punishment
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  haveChild() {
Â  Â  Â  Â  this.city.resources.food -= 50; // Cost
Â  Â  Â  Â  const baby = game.spawnUnit(this.x, this.y, this.race, this.city, [this, this.partner]);
Â  Â  Â  Â  this.children++;
Â  Â  Â  Â  this.partner.children++;
Â  Â  Â  Â  game.addParticle(this.x, this.y, 'ğŸ‘¶');
Â  Â  Â  Â  ui.toast(`Birth: ${baby.name}`);
Â  Â  }

Â  Â  die(reason) {
Â  Â  Â  Â  this.dead = true;
Â  Â  Â  Â  if(this.city) this.city.pop = this.city.pop.filter(u => u !== this);
Â  Â  Â  Â  if(this.partner) {Â 
Â  Â  Â  Â  Â  Â  this.partner.mood -= 50;Â 
Â  Â  Â  Â  Â  Â  this.partner.journal.push(`Partner ${this.name} died`);
Â  Â  Â  Â  Â  Â  this.partner.partner = null;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  game.addParticle(this.x, this.y, 'ğŸ’€', 'white');
Â  Â  }
}

/** --- UI MANAGER --- */
const ui = {
Â  Â  selected: null,
Â  Â  tool: 'select',
Â  Â Â 
Â  Â  update: function() {
Â  Â  Â  Â  document.getElementById('ui-year').innerText = game.year;
Â  Â  Â  Â  document.getElementById('ui-pop').innerText = game.units.length;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Calc Avg Crime
Â  Â  Â  Â  let totalCrime = 0;
Â  Â  Â  Â  game.units.forEach(u => totalCrime += u.crime);
Â  Â  Â  Â  let avg = game.units.length ? Math.floor(totalCrime/game.units.length) : 0;
Â  Â  Â  Â  const el = document.getElementById('ui-crime');
Â  Â  Â  Â  el.innerText = avg + '%';
Â  Â  Â  Â  el.style.color = avg > 20 ? 'red' : '#e0e0e0';

Â  Â  Â  Â  if(this.selected) this.renderInspector();
Â  Â  },

Â  Â  select: function(obj) {
Â  Â  Â  Â  this.selected = obj;
Â  Â  Â  Â  document.getElementById('inspector').style.display = obj ? 'block' : 'none';
Â  Â  Â  Â  if(obj) this.renderInspector();
Â  Â  },

Â  Â  setTool: function(t) {
Â  Â  Â  Â  this.tool = t;
Â  Â  Â  Â  document.querySelectorAll('.toolbar button').forEach(b => b.classList.remove('active'));
Â  Â  Â  Â  const btn = document.getElementById(t==='select'?'btn-select':(t==='drag'?'btn-drag':''));
Â  Â  Â  Â  if(btn) btn.classList.add('active');
Â  Â  },

Â  Â  toast: function(msg, type='') {
Â  Â  Â  Â  const d = document.createElement('div');
Â  Â  Â  Â  d.className = `toast ${type}`;
Â  Â  Â  Â  d.innerText = msg;
Â  Â  Â  Â  document.getElementById('toast-container').appendChild(d);
Â  Â  Â  Â  setTimeout(()=>d.remove(), 6000);
Â  Â  },

Â  Â  renderInspector: function() {
Â  Â  Â  Â  const div = document.getElementById('inspector');
Â  Â  Â  Â  const s = this.selected;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(s instanceof Unit) {
Â  Â  Â  Â  Â  Â  let traitsHtml = s.traits.map(t => `<span class="trait-badge ${t.name==='Arcane'?'trait-magic':(t.name==='Violent'?'trait-crime':'')}">${t.name}</span>`).join('');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="header-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="avatar" style="border-color:${s.crime>50?'red':'var(--accent)'}">${s.emoji}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>${s.name} ${s.job === JOBS.KING ? 'ğŸ‘‘' : ''}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>${s.race.name} ${s.job} | Age ${Math.floor(s.age)}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="inspector-row"><span>Health</span> <span style="color:${s.health<50?'red':'lime'}">${s.health}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="inspector-row"><span>Mana</span> <span style="color:var(--magic)">${s.mana} / ${s.maxMana}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Personality</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:10px; margin-bottom:5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Aggression: ${s.personality.agg}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bar-con"><div class="bar-fill" style="width:${s.personality.agg}%; background:red;"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Greed: ${s.personality.grd}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bar-con"><div class="bar-fill" style="width:${s.personality.grd}%; background:gold;"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Loyalty: ${s.personality.loy}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bar-con"><div class="bar-fill" style="width:${s.personality.loy}%; background:cyan;"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="inspector-row"><span>Criminal Record</span> <span style="color:red">${s.crime}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin:5px 0;">${traitsHtml || '<span style="color:#666">No Traits</span>'}</div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Stats</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="inspector-row"><span>STR: ${s.stats.str}</span> <span>INT: ${s.stats.int}</span> <span>CHA: ${s.stats.cha}</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  <h3>Journal</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="max-height:80px; overflow-y:auto; color:#888;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${s.journal.map(j=>`<div>â€¢ ${j}</div>`).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  } else if (s instanceof City) {
Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="header-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="avatar">ğŸ°</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>${s.name} ${s.isCapital ? '(Capital)' : ''}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Pop: ${s.pop.length}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="inspector-row"><span>Ruler</span> <span style="color:gold">${s.ruler ? s.ruler.name : 'None'}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="inspector-row"><span>Food</span> <span>${Math.floor(s.resources.food)}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="inspector-row"><span>Gold</span> <span style="color:gold">${Math.floor(s.resources.gold)}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <br>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:center; color:#666; font-style:italic">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${s.isCapital ? 'The seat of power.' : 'A growing settlement.'}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }
Â  Â  }
};

// Start
const game = new Game();
game.init();

</script>
</body>
</html>
