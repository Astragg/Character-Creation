import React, { useState, useEffect, useMemo } from 'react';
import { initializeApp } from 'firebase/app';
import { 
  getAuth, 
  signInAnonymously, 
  signInWithCustomToken,
  onAuthStateChanged 
} from 'firebase/auth';
import { 
  getFirestore, 
  collection, 
  doc, 
  setDoc, 
  onSnapshot, 
  updateDoc, 
  arrayUnion,
  getDoc
} from 'firebase/firestore';
import { 
  Crown, 
  Users, 
  LogOut, 
  Play, 
  RefreshCw, 
  Trash2, 
  Shield, 
  Hand,
  ArrowUp,
  ArrowDown,
  Spade,
  Club,
  Heart,
  Diamond
} from 'lucide-react';

// --- Firebase Configuration & Init ---
const firebaseConfig = {
  apiKey: "AIzaSyDCrKQVcGBW4iy7OMAtn4Jcf1ot5CGALBE",
  authDomain: "highnoon-66ee0.firebaseapp.com",
  databaseURL: "https://highnoon-66ee0-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "highnoon-66ee0",
  storageBucket: "highnoon-66ee0.firebasestorage.app",
  messagingSenderId: "754268761672",
  appId: "1:754268761672:web:7fbf59d2c403b43356727d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
// Using your project ID as the default app ID for data storage paths
const appId = typeof __app_id !== 'undefined' ? __app_id : 'highnoon-66ee0';

// --- Constants & Utils ---
const SUITS = ['♠', '♥', '♣', '♦'];
const VALUES = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

const generateDeck = () => {
  let deck = [];
  SUITS.forEach(suit => {
    VALUES.forEach(value => {
      deck.push({ suit, value, id: Math.random().toString(36).substr(2, 9) });
    });
  });
  // Shuffle Fisher-Yates
  for (let i = deck.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [deck[i], deck[j]] = [deck[j], deck[i]];
  }
  return deck;
};

const calculateScore21 = (hand) => {
  let score = 0;
  let aces = 0;
  hand.forEach(card => {
    if (['J', 'Q', 'K'].includes(card.value)) score += 10;
    else if (card.value === 'A') { score += 11; aces += 1; }
    else score += parseInt(card.value);
  });
  while (score > 21 && aces > 0) {
    score -= 10;
    aces -= 1;
  }
  return score;
};

const getCardColor = (suit) => (suit === '♥' || suit === '♦' ? 'text-red-500' : 'text-gray-800');

// --- Components ---

const Card = ({ card, hidden = false }) => {
  if (hidden) {
    return (
      <div className="w-10 h-14 sm:w-12 sm:h-16 bg-blue-800 border-2 border-white rounded-md shadow flex items-center justify-center bg-opacity-90">
        <div className="w-8 h-12 border border-blue-600 rounded opacity-50"></div>
      </div>
    );
  }
  return (
    <div className="w-10 h-14 sm:w-12 sm:h-16 bg-white rounded-md shadow-lg flex flex-col items-center justify-center border border-gray-300 select-none relative">
      <span className={`text-sm font-bold ${getCardColor(card.suit)}`}>{card.value}</span>
      <span className={`text-lg leading-none ${getCardColor(card.suit)}`}>{card.suit}</span>
    </div>
  );
};

const App = () => {
  const [user, setUser] = useState(null);
  const [roomCode, setRoomCode] = useState('');
  const [gameState, setGameState] = useState(null);
  const [isJoinMode, setIsJoinMode] = useState(true);
  const [createPass, setCreatePass] = useState('');
  const [error, setError] = useState('');
  const [dealerKeyInput, setDealerKeyInput] = useState('');
  const [showDealerModal, setShowDealerModal] = useState(false);

  // --- Auth ---
  useEffect(() => {
    const initAuth = async () => {
      try {
        // Attempt to use the environment token if available
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          // If no token is provided by the environment, go straight to anonymous
          await signInAnonymously(auth);
        }
      } catch (err) {
        // If the environment token fails (likely due to project mismatch since we are using a custom config),
        // fall back gracefully to anonymous auth for your specific project.
        console.warn("Custom token auth failed (expected if using custom Firebase config), falling back to anonymous:", err);
        try {
          await signInAnonymously(auth);
        } catch (anonErr) {
          console.error("Anonymous auth also failed:", anonErr);
          setError("Authentication failed. Please check if Anonymous Auth is enabled in Firebase Console.");
        }
      }
    };
    initAuth();
    return onAuthStateChanged(auth, setUser);
  }, []);

  // --- Room Sync ---
  useEffect(() => {
    if (!user || !roomCode) return;
    // Using appId here to keep paths consistent
    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
    const unsub = onSnapshot(roomRef, (snap) => {
      if (snap.exists()) {
        setGameState(snap.data());
      } else {
        setGameState(null);
      }
    }, (err) => {
      console.error("Sync error", err);
      if (err.code === 'permission-denied') {
        setError("Permission denied. Ensure your Firestore rules allow access.");
      }
    });
    return () => unsub();
  }, [user, roomCode]);

  // --- Actions ---

  const createRoom = async () => {
    if (!user) return;
    const code = Math.random().toString(36).substring(2, 6).toUpperCase();
    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), code);
    
    const newRoom = {
      hostId: user.uid,
      dealerKey: createPass || 'admin', // Default key if empty
      dealerId: null,
      gameType: '21', // Default game
      deck: generateDeck(),
      players: Array(10).fill(null), // 10 Empty seats
      logs: [`Room ${code} created.`],
      status: 'waiting'
    };

    await setDoc(roomRef, newRoom);
    setRoomCode(code);
  };

  const joinRoom = async (code) => {
    if (!code) return;
    setRoomCode(code.toUpperCase());
  };

  const leaveRoom = () => {
    setRoomCode('');
    setGameState(null);
  };

  const claimSeat = async (index) => {
    if (!gameState || !user) return;
    // Check if already seated
    const existingSeat = gameState.players.findIndex(p => p?.id === user.uid);
    if (existingSeat !== -1) {
      setError("You are already seated!");
      setTimeout(() => setError(''), 2000);
      return;
    }

    const newPlayers = [...gameState.players];
    newPlayers[index] = {
      id: user.uid,
      name: `Player ${user.uid.slice(0,4)}`,
      hand: [],
      chips: 100,
      bet: 0,
      status: 'ready' // ready, hit, stand
    };

    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
    await updateDoc(roomRef, { players: newPlayers });
  };

  const leaveSeat = async (index) => {
    const newPlayers = [...gameState.players];
    newPlayers[index] = null;
    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
    await updateDoc(roomRef, { players: newPlayers });
  };

  const attemptClaimDealer = async () => {
    if (dealerKeyInput === gameState.dealerKey) {
      const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
      await updateDoc(roomRef, { dealerId: user.uid });
      setShowDealerModal(false);
    } else {
      setError("Incorrect Dealer Key");
      setTimeout(() => setError(''), 2000);
    }
  };

  const leaveDealer = async () => {
    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
    await updateDoc(roomRef, { dealerId: null });
  };

  // --- Dealer / GM Actions ---

  const gmDealCard = async (seatIndex) => {
    if (!gameState.deck.length) return;
    const newDeck = [...gameState.deck];
    const card = newDeck.pop();
    
    const newPlayers = [...gameState.players];
    if (newPlayers[seatIndex]) {
      newPlayers[seatIndex].hand = [...newPlayers[seatIndex].hand, card];
      // Reset status if they were asking for a hit
      if(newPlayers[seatIndex].status === 'hit') newPlayers[seatIndex].status = 'ready';
    }

    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
    await updateDoc(roomRef, { deck: newDeck, players: newPlayers });
  };

  const gmResetRound = async () => {
    const newPlayers = gameState.players.map(p => p ? ({ ...p, hand: [], status: 'ready', bet: 0 }) : null);
    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
    await updateDoc(roomRef, { players: newPlayers, logs: arrayUnion("Round Reset") });
  };

  const gmShuffle = async () => {
    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
    await updateDoc(roomRef, { deck: generateDeck(), logs: arrayUnion("Deck Shuffled") });
  };

  const gmChangeGame = async (type) => {
    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
    await updateDoc(roomRef, { gameType: type, logs: arrayUnion(`Game changed to ${type}`) });
  };

  // --- Player Actions ---
  const playerAction = async (seatIndex, action) => {
    const newPlayers = [...gameState.players];
    if (newPlayers[seatIndex]) {
        newPlayers[seatIndex].status = action;
    }
    const roomRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'rooms'), roomCode);
    await updateDoc(roomRef, { players: newPlayers });
  };


  // --- Render Helpers ---

  if (!user) return <div className="flex items-center justify-center h-screen bg-green-900 text-white">Connecting to Casino...</div>;

  // LOBBY
  if (!gameState) {
    return (
      <div className="min-h-screen bg-green-900 flex flex-col items-center justify-center p-4 text-white font-sans">
        <div className="max-w-md w-full bg-green-800 p-8 rounded-xl shadow-2xl border border-green-600">
          <div className="flex justify-center mb-6">
            <Club className="w-12 h-12 text-white mr-2" />
            <h1 className="text-4xl font-bold tracking-wider text-gold-400">GM CASINO</h1>
          </div>
          
          <div className="flex space-x-2 mb-6 bg-green-900 p-1 rounded-lg">
            <button 
              onClick={() => setIsJoinMode(true)}
              className={`flex-1 py-2 rounded-md transition-all ${isJoinMode ? 'bg-yellow-500 text-black font-bold shadow-md' : 'text-gray-400 hover:text-white'}`}
            >
              Join Room
            </button>
            <button 
              onClick={() => setIsJoinMode(false)}
              className={`flex-1 py-2 rounded-md transition-all ${!isJoinMode ? 'bg-yellow-500 text-black font-bold shadow-md' : 'text-gray-400 hover:text-white'}`}
            >
              Create Room
            </button>
          </div>

          {isJoinMode ? (
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-green-200 mb-1">Room Code</label>
                <input 
                  type="text" 
                  value={roomCode}
                  onChange={(e) => setRoomCode(e.target.value.toUpperCase())}
                  placeholder="ABCD"
                  className="w-full bg-green-900 border border-green-600 rounded px-4 py-3 text-center text-2xl tracking-widest focus:outline-none focus:ring-2 focus:ring-yellow-500 uppercase"
                />
              </div>
              <button 
                onClick={() => joinRoom(roomCode)}
                className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 text-black font-bold py-3 rounded hover:from-yellow-400 hover:to-yellow-500 transform transition hover:scale-105"
              >
                ENTER CASINO
              </button>
            </div>
          ) : (
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-green-200 mb-1">Dealer Key (GM Password)</label>
                <input 
                  type="text" 
                  value={createPass}
                  onChange={(e) => setCreatePass(e.target.value)}
                  placeholder="Secret Key"
                  className="w-full bg-green-900 border border-green-600 rounded px-4 py-3 text-center text-lg focus:outline-none focus:ring-2 focus:ring-yellow-500"
                />
              </div>
              <button 
                onClick={createRoom}
                className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 text-black font-bold py-3 rounded hover:from-yellow-400 hover:to-yellow-500 transform transition hover:scale-105"
              >
                OPEN TABLE
              </button>
            </div>
          )}
          {error && <p className="text-red-400 text-center mt-4 text-sm bg-black bg-opacity-20 p-2 rounded">{error}</p>}
        </div>
      </div>
    );
  }

  // GAME ROOM
  const isDealer = gameState.dealerId === user.uid;
  const mySeatIndex = gameState.players.findIndex(p => p?.id === user.uid);
  const isSeated = mySeatIndex !== -1;

  return (
    <div className="min-h-screen bg-green-900 text-white flex flex-col overflow-hidden font-sans">
      {/* Header */}
      <div className="h-14 bg-green-950 flex items-center justify-between px-4 shadow-md z-10">
        <div className="flex items-center space-x-4">
          <span className="font-bold text-yellow-500 text-xl tracking-widest">{gameState.gameType.toUpperCase()}</span>
          <span className="px-2 py-1 bg-green-800 rounded text-xs font-mono">RM: {roomCode}</span>
        </div>
        <div className="flex items-center space-x-2">
            <div className="text-xs text-gray-400 hidden sm:block">{user.uid.slice(0,6)}</div>
            <button onClick={leaveRoom} className="p-2 hover:bg-red-900 rounded text-red-400"><LogOut size={18}/></button>
        </div>
      </div>

      {/* Main Table Area */}
      <div className="flex-1 relative overflow-hidden flex flex-col">
        
        {/* Dealer Zone (Top Center) */}
        <div className="flex justify-center pt-4 pb-8 relative z-0">
          {gameState.dealerId ? (
             <div className="flex flex-col items-center">
                <div className="w-16 h-16 rounded-full bg-gray-800 border-4 border-yellow-600 flex items-center justify-center shadow-lg mb-2">
                    <Shield className="text-yellow-500 w-8 h-8" />
                </div>
                <span className="text-yellow-500 font-bold text-sm bg-black bg-opacity-50 px-2 rounded">DEALER</span>
                
                {/* Only show Leave Dealer button if YOU are the dealer */}
                {isDealer && (
                    <button onClick={leaveDealer} className="mt-1 text-xs text-red-400 hover:underline">Leave Seat</button>
                )}
             </div>
          ) : (
            <div className="flex flex-col items-center animate-pulse">
               <button 
                 onClick={() => setShowDealerModal(true)}
                 className="w-16 h-16 rounded-full bg-green-800 border-4 border-gray-600 flex items-center justify-center shadow-lg mb-2 hover:bg-green-700 transition"
               >
                   <Users className="text-gray-400 w-6 h-6" />
               </button>
               <span className="text-gray-400 font-bold text-sm">NO DEALER</span>
            </div>
          )}
        </div>

        {/* Dealer Control Panel (Floating - Only Visible to Dealer) */}
        {isDealer && (
            <div className="absolute top-4 right-4 bg-black bg-opacity-80 p-3 rounded-lg border border-gray-700 shadow-xl z-20 w-64">
                <h3 className="text-xs font-bold text-yellow-500 uppercase mb-2 border-b border-gray-700 pb-1">GM Controls</h3>
                
                <div className="grid grid-cols-2 gap-2 mb-3">
                    <button onClick={gmShuffle} className="bg-blue-900 hover:bg-blue-700 text-xs py-1 px-2 rounded flex items-center justify-center"><RefreshCw size={12} className="mr-1"/> Shuffle</button>
                    <button onClick={gmResetRound} className="bg-red-900 hover:bg-red-700 text-xs py-1 px-2 rounded flex items-center justify-center"><Trash2 size={12} className="mr-1"/> Clear All</button>
                </div>

                <div className="mb-2">
                    <label className="text-xs text-gray-400">Game Mode:</label>
                    <select 
                        value={gameState.gameType} 
                        onChange={(e) => gmChangeGame(e.target.value)}
                        className="w-full bg-gray-800 text-xs p-1 rounded mt-1 border border-gray-600"
                    >
                        <option value="21">Blackjack (21)</option>
                        <option value="HighLow">Higher / Lower</option>
                        <option value="RedBlack">Red / Black</option>
                    </select>
                </div>
                
                <div className="text-xs text-gray-500 italic text-center mt-2">
                    Tap "Deal" on players to give cards.
                </div>
            </div>
        )}

        {/* Table Felt Text */}
        <div className="absolute inset-0 flex items-center justify-center pointer-events-none opacity-10">
            <span className="text-9xl font-serif font-bold text-black transform -rotate-12 select-none">
                {gameState.gameType}
            </span>
        </div>

        {/* Player Seats Grid - Flex wrapping for 10 seats */}
        <div className="flex-1 p-4 overflow-y-auto">
            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 max-w-6xl mx-auto">
                {gameState.players.map((player, idx) => {
                    const isMe = player?.id === user.uid;
                    
                    return (
                        <div key={idx} className={`relative flex flex-col items-center p-2 rounded-xl min-h-[180px] transition-all border-2 ${isMe ? 'bg-green-800 bg-opacity-60 border-yellow-500' : 'bg-green-900 bg-opacity-40 border-transparent'}`}>
                            
                            {/* Seat Header / Avatar */}
                            {!player ? (
                                <button 
                                    onClick={() => claimSeat(idx)}
                                    disabled={isSeated && !isDealer} 
                                    className="flex flex-col items-center justify-center h-full w-full opacity-50 hover:opacity-100 disabled:opacity-20 disabled:cursor-not-allowed group"
                                >
                                    <div className="w-12 h-12 rounded-full border-2 border-dashed border-gray-400 flex items-center justify-center group-hover:border-yellow-400 group-hover:bg-green-800 transition">
                                        <span className="text-sm font-bold text-gray-300">SIT</span>
                                    </div>
                                </button>
                            ) : (
                                <>
                                    {/* Player Info */}
                                    <div className="w-full flex justify-between items-start mb-2">
                                        <div className="flex items-center space-x-1">
                                            <div className="w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 text-[10px] flex items-center justify-center font-bold">
                                                {idx + 1}
                                            </div>
                                            <span className="text-xs font-bold truncate max-w-[60px]">{player.name}</span>
                                        </div>
                                        
                                        {/* Dealer Deal Button (Only visible to Dealer) */}
                                        {isDealer && (
                                            <button 
                                                onClick={() => gmDealCard(idx)}
                                                className="bg-yellow-600 hover:bg-yellow-500 text-black text-[10px] font-bold px-2 py-1 rounded shadow-sm flex items-center"
                                            >
                                                <Hand size={10} className="mr-1"/> DEAL
                                            </button>
                                        )}

                                        {/* Leave Seat Button (Me or Dealer) */}
                                        {(isMe || isDealer) && (
                                            <button onClick={() => leaveSeat(idx)} className="text-gray-500 hover:text-red-400">
                                                <LogOut size={12}/>
                                            </button>
                                        )}
                                    </div>

                                    {/* Cards Area */}
                                    <div className="flex -space-x-6 mb-2 h-20 items-center justify-center w-full px-2">
                                        {player.hand && player.hand.length > 0 ? (
                                            player.hand.map((card, cIdx) => (
                                                <div key={cIdx} className="transform hover:-translate-y-2 transition-transform duration-200" style={{zIndex: cIdx}}>
                                                    <Card card={card} />
                                                </div>
                                            ))
                                        ) : (
                                            <div className="w-10 h-14 rounded border-2 border-dashed border-green-700 opacity-30"></div>
                                        )}
                                    </div>

                                    {/* Game Specific Stats */}
                                    <div className="mt-auto w-full text-center">
                                        {gameState.gameType === '21' && player.hand.length > 0 && (
                                            <div className="inline-block px-2 py-0.5 bg-black bg-opacity-50 rounded text-xs font-mono text-yellow-400">
                                                {calculateScore21(player.hand)}
                                            </div>
                                        )}
                                    </div>

                                    {/* Status Indicators (Requests) */}
                                    {player.status !== 'ready' && (
                                        <div className={`absolute -top-2 -right-2 px-2 py-1 rounded text-[10px] font-bold shadow uppercase animate-bounce ${
                                            player.status === 'hit' ? 'bg-blue-500 text-white' : 
                                            player.status === 'stand' ? 'bg-red-500 text-white' : 
                                            player.status === 'high' ? 'bg-purple-500 text-white' :
                                            player.status === 'low' ? 'bg-pink-500 text-white' : 
                                            'bg-gray-500'
                                        }`}>
                                            {player.status}
                                        </div>
                                    )}

                                    {/* Player Actions (If it is ME) */}
                                    {isMe && (
                                        <div className="flex gap-1 mt-2 w-full">
                                            {gameState.gameType === '21' && (
                                                <>
                                                    <button 
                                                        onClick={() => playerAction(idx, 'hit')}
                                                        className="flex-1 bg-blue-600 hover:bg-blue-500 text-[10px] py-1 rounded font-bold shadow"
                                                    >
                                                        HIT
                                                    </button>
                                                    <button 
                                                        onClick={() => playerAction(idx, 'stand')}
                                                        className="flex-1 bg-red-600 hover:bg-red-500 text-[10px] py-1 rounded font-bold shadow"
                                                    >
                                                        STAY
                                                    </button>
                                                </>
                                            )}
                                            {gameState.gameType === 'HighLow' && (
                                                <>
                                                    <button 
                                                        onClick={() => playerAction(idx, 'high')}
                                                        className="flex-1 bg-purple-600 hover:bg-purple-500 text-[10px] py-1 rounded font-bold shadow flex justify-center"
                                                    >
                                                        <ArrowUp size={12}/>
                                                    </button>
                                                    <button 
                                                        onClick={() => playerAction(idx, 'low')}
                                                        className="flex-1 bg-pink-600 hover:bg-pink-500 text-[10px] py-1 rounded font-bold shadow flex justify-center"
                                                    >
                                                        <ArrowDown size={12}/>
                                                    </button>
                                                </>
                                            )}
                                            {gameState.gameType === 'RedBlack' && (
                                                <>
                                                    <button 
                                                        onClick={() => playerAction(idx, 'red')}
                                                        className="flex-1 bg-red-600 hover:bg-red-500 text-[10px] py-1 rounded font-bold shadow"
                                                    >
                                                        RED
                                                    </button>
                                                    <button 
                                                        onClick={() => playerAction(idx, 'black')}
                                                        className="flex-1 bg-gray-900 hover:bg-gray-800 text-[10px] py-1 rounded font-bold shadow border border-gray-600"
                                                    >
                                                        BLK
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    )}
                                </>
                            )}
                        </div>
                    );
                })}
            </div>
        </div>
      </div>

      {/* Dealer Modal */}
      {showDealerModal && (
          <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 px-4">
              <div className="bg-gray-800 p-6 rounded-lg border border-yellow-600 max-w-sm w-full text-center">
                  <Shield className="w-12 h-12 text-yellow-500 mx-auto mb-4" />
                  <h2 className="text-xl font-bold text-white mb-2">Dealer Access</h2>
                  <p className="text-gray-400 text-sm mb-4">Enter the room Key to take the Dealer Seat.</p>
                  <input 
                    type="password" 
                    value={dealerKeyInput}
                    onChange={e => setDealerKeyInput(e.target.value)}
                    className="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-white text-center mb-4 focus:border-yellow-500 outline-none"
                  />
                  <div className="flex gap-2">
                      <button onClick={() => setShowDealerModal(false)} className="flex-1 py-2 bg-gray-700 rounded hover:bg-gray-600 text-sm font-bold">CANCEL</button>
                      <button onClick={attemptClaimDealer} className="flex-1 py-2 bg-yellow-600 rounded hover:bg-yellow-500 text-black text-sm font-bold">ENTER</button>
                  </div>
                  {error && <p className="text-red-400 text-xs mt-2">{error}</p>}
              </div>
          </div>
      )}
      
      {/* Global Error Toast */}
      {error && !showDealerModal && (
          <div className="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-2 rounded-full shadow-xl font-bold z-50 animate-bounce">
              {error}
          </div>
      )}

    </div>
  );
};

export default App;
