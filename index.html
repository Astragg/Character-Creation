<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soul Society Archives</title>
    <style>
        :root {
            --bg-app: #121212;
            --bg-panel: #1e1e1e;
            --bg-card: #2b2b2b;
            --bg-input: #0f0f0f;
            --accent: #b91c1c; /* Blood Red */
            --text-main: #e5e5e5;
            --text-muted: #a3a3a3;
            --border: #404040;
            --stat-width: 100px;
        }

        * { box-sizing: border-box; scrollbar-width: thin; scrollbar-color: var(--accent) var(--bg-panel); }
        body { margin: 0; padding: 0; background-color: var(--bg-app); color: var(--text-main); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; height: 100vh; overflow: hidden; }

        /* --- LAYOUT GRID --- */
        .app { display: flex; width: 100%; height: 100%; }
        
        /* 1. EDITOR SIDEBAR (Inputs) */
        .editor {
            width: 320px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            padding: 20px;
            overflow-y: auto;
            flex-shrink: 0;
            z-index: 10;
        }

        /* 2. DASHBOARD (The Sheet) */
        .dashboard {
            flex-grow: 1;
            display: grid;
            grid-template-columns: 120px 1fr 280px; /* Stats | Main | RightWidgets */
            grid-template-rows: 100px 1fr; /* Header | Body */
            gap: 15px;
            padding: 20px;
            overflow: hidden;
        }

        /* --- STYLING COMPONENTS --- */
        h1, h2, h3 { margin: 0; text-transform: uppercase; letter-spacing: 1px; }
        h2 { font-size: 0.9rem; color: var(--accent); margin-bottom: 10px; border-bottom: 1px solid var(--border); padding-bottom: 5px; }
        label { display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 4px; }
        
        input, select {
            width: 100%; background: var(--bg-input); border: 1px solid #333; color: white; padding: 8px; margin-bottom: 15px; border-radius: 4px;
        }
        input:focus, select:focus { outline: 1px solid var(--accent); }

        /* HEADER (Top Row) */
        .dash-header {
            grid-column: 1 / -1;
            background: var(--bg-panel);
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
            border: 1px solid var(--border);
        }

        .char-identity h1 { font-size: 1.5rem; font-weight: 800; }
        .char-identity span { color: var(--text-muted); font-size: 0.9rem; }

        .vitals { display: flex; gap: 20px; }
        .vital-box {
            text-align: center;
            background: var(--bg-input);
            padding: 10px 20px;
            border-radius: 6px;
            border: 1px solid #333;
            min-width: 80px;
        }
        .vital-val { display: block; font-size: 1.4rem; font-weight: bold; color: white; }
        .vital-label { font-size: 0.7rem; color: var(--accent); text-transform: uppercase; font-weight: bold; }
        .hp-box { border-color: var(--accent); }

        /* STATS COLUMN (Left) */
        .col-stats {
            grid-column: 1;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .stat-shield {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            text-align: center;
            padding: 10px 0;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        /* The "Shield" shape via CSS clip-path or simple border styling */
        .stat-shield::before {
            content: ''; position: absolute; top:0; left:0; right:0; height: 3px; background: var(--accent);
            border-radius: 6px 6px 0 0;
        }
        .stat-mod { font-size: 1.8rem; font-weight: bold; display: block; line-height: 1; }
        .stat-score { font-size: 0.8rem; color: var(--text-muted); background: var(--bg-input); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 5px; }
        .stat-name { font-size: 0.7rem; text-transform: uppercase; display: block; margin-bottom: 5px; color: #aaa; }

        /* MAIN STAGE (Center) */
        .col-main {
            grid-column: 2;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: hidden; /* Internal scrolling only */
        }

        .tab-bar { display: flex; gap: 10px; margin-bottom: 5px; }
        .tab { background: var(--bg-panel); color: #888; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 0.8rem; }
        .tab.active { background: var(--accent); color: white; }

        .panel-content {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .card h3 { font-size: 1rem; color: white; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .card-meta { font-size: 0.75rem; color: var(--accent); font-style: italic; margin-bottom: 8px; }
        .card-desc { font-size: 0.9rem; color: #ccc; line-height: 1.5; white-space: pre-wrap; }

        /* ACTION ROWS */
        .action-row { display: flex; justify-content: space-between; align-items: center; background: var(--bg-input); padding: 10px; margin-bottom: 5px; border-radius: 4px; border-left: 3px solid var(--accent); }
        .action-name { font-weight: bold; }
        .action-roll { background: #333; padding: 2px 8px; border-radius: 4px; font-size: 0.9rem; color: #fff; }

        /* RIGHT WIDGETS */
        .col-widgets {
            grid-column: 3;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        .widget { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 6px; padding: 15px; }
        .skill-row { display: flex; justify-content: space-between; font-size: 0.85rem; padding: 4px 0; border-bottom: 1px solid #333; }
        .skill-row span:last-child { color: var(--text-main); font-weight: bold; }
        .prof-dot { color: #333; margin-right: 5px; }
        .prof-dot.active { color: var(--accent); }

    </style>
</head>
<body>

<div class="app">
    
    <div class="editor">
        <h2>Character Builder</h2>
        
        <label>Name</label>
        <input type="text" id="inName" value="Grimmjow" oninput="updateSheet()">
        
        <label>Race</label>
        <select id="inRace" onchange="updateSheet()"></select>
        
        <label>Class</label>
        <select id="inClass" onchange="loadClass()"></select>
        
        <label>Subclass</label>
        <select id="inSubclass" onchange="updateSheet()"></select>
        
        <label>Level</label>
        <input type="number" id="inLevel" value="1" min="1" max="20" oninput="updateSheet()">

        <h2>Ability Scores</h2>
        <div id="statInputs"></div>

        <h2>Skill Proficiencies</h2>
        <div id="skillInputs"></div>

        <div id="classOptionsArea">
            <h2>Class Options</h2>
            <div id="evoInputs"></div>
        </div>
    </div>

    <div class="dashboard">
        
        <div class="dash-header">
            <div class="char-identity">
                <h1 id="outName">Grimmjow</h1>
                <span id="outRaceClass">Arrancar - Level 1</span>
            </div>
            <div class="vitals">
                <div class="vital-box">
                    <span class="vital-label">Armor Class</span>
                    <span class="vital-val" id="outAC">10</span>
                </div>
                <div class="vital-box">
                    <span class="vital-label">Initiative</span>
                    <span class="vital-val" id="outInit">+0</span>
                </div>
                <div class="vital-box">
                    <span class="vital-label">Speed</span>
                    <span class="vital-val" id="outSpeed">30</span>
                </div>
                <div class="vital-box hp-box">
                    <span class="vital-label">Hit Points</span>
                    <span class="vital-val" id="outHP">10</span>
                </div>
                <div class="vital-box" style="border-color: #555;">
                    <span class="vital-label" id="outResName">Reiatsu</span>
                    <span class="vital-val" id="outResVal">2</span>
                </div>
            </div>
        </div>

        <div class="col-stats" id="outStats">
            </div>

        <div class="col-main">
            <div class="tab-bar">
                <button class="tab active">Actions</button>
                <button class="tab">Features</button>
                <button class="tab">Spells</button>
                <button class="tab">Inventory</button>
            </div>
            
            <div class="panel-content" id="mainPanel">
                </div>
        </div>

        <div class="col-widgets">
            <div class="widget">
                <h2>Proficiencies</h2>
                <div style="font-size: 0.9rem; margin-bottom: 10px;">
                    Bonus: <span id="outProfBonus" style="color:var(--accent); font-weight:bold;">+2</span>
                </div>
                <div id="outSkills"></div>
            </div>
            <div class="widget">
                <h2>Saving Throws</h2>
                <div id="outSaves"></div>
            </div>
        </div>

    </div>
</div>

<script>
    /* --- DATASETS --- */
    const STATS = ["STR", "DEX", "CON", "INT", "WIS", "CHA"];
    const SKILLS = {
        "Acrobatics": "DEX", "Animal Handling": "WIS", "Arcana": "INT", "Athletics": "STR",
        "Deception": "CHA", "History": "INT", "Insight": "WIS", "Intimidation": "CHA",
        "Investigation": "INT", "Medicine": "WIS", "Nature": "INT", "Perception": "WIS",
        "Performance": "CHA", "Persuasion": "CHA", "Religion": "INT", "Sleight of Hand": "DEX",
        "Stealth": "DEX", "Survival": "WIS"
    };

    const RACES = {
        "Human": { speed: 30, size: "Medium", traits: [{name:"Versatile", desc:"Gain a Feat."}] },
        "Plus Soul": { speed: 30, size: "Medium", traits: [{name:"Spirit Sight", desc:"Can see spirits."}] },
        "Hollow": { speed: 40, size: "Large", traits: [{name:"Mask", desc:"Advantage on Intimidation."}] },
        "Arrancar": { speed: 30, size: "Medium", traits: [{name:"Hollow Origin", desc:"Retain hollow characteristics."}]}
    };

    const CLASSES = {
        "Arrancar": {
            hd: 10,
            primary: "CON",
            saves: ["CON", "DEX"],
            resource: "Reiatsu",
            scaling: [
                { lvl: 1, prof: 2, res: 2, extra: "1d10 Cero" }, { lvl: 2, prof: 2, res: 3, extra: "1d10 Cero" },
                { lvl: 3, prof: 2, res: 4, extra: "2d10 Cero" }, { lvl: 4, prof: 2, res: 5, extra: "2d10 Cero" },
                { lvl: 5, prof: 3, res: 6, extra: "2d10 Cero" }, { lvl: 6, prof: 3, res: 7, extra: "3d10 Cero" },
                { lvl: 7, prof: 3, res: 8, extra: "3d10 Cero" }, { lvl: 8, prof: 3, res: 9, extra: "3d10 Cero" },
                { lvl: 9, prof: 4, res: 10, extra: "4d10 Cero" }, { lvl: 10, prof: 4, res: 11, extra: "4d10 Cero" },
                { lvl: 11, prof: 4, res: 12, extra: "5d10 Cero" }, { lvl: 12, prof: 4, res: 13, extra: "5d10 Cero" },
                { lvl: 13, prof: 5, res: 14, extra: "5d10 Cero" }, { lvl: 14, prof: 5, res: 15, extra: "6d10 Cero" },
                { lvl: 15, prof: 5, res: 16, extra: "6d10 Cero" }, { lvl: 16, prof: 5, res: 17, extra: "6d10 Cero" },
                { lvl: 17, prof: 6, res: 18, extra: "7d10 Cero" }, { lvl: 18, prof: 6, res: 19, extra: "8d10 Cero" },
                { lvl: 19, prof: 6, res: 20, extra: "8d10 Cero" }, { lvl: 20, prof: 6, res: 25, extra: "10d10 Cero" }
            ],
            features: [
                { lvl: 1, name: "Hierro (Iron Skin)", desc: "AC = 10 + DEX + CON. Reaction: Reduce damage by 1d10 + Level." },
                { lvl: 1, name: "Bala", desc: "Bonus Action. Ranged Spell Attack. Damage: 1d6 Force." },
                { lvl: 2, name: "Cero", desc: "Action. 100ft Line or 30ft Cone. DEX Save. Cost: 2 Reiatsu." },
                { lvl: 2, name: "Sonído", desc: "Bonus Action. Teleport 30ft. Cost: 1 Reiatsu." },
                { lvl: 5, name: "Extra Attack", desc: "You can attack twice whenever you take the Attack action." },
                { lvl: 6, name: "High-Speed Regeneration", desc: "Bonus Action. Spend Reiatsu to heal 1d10 per point." }
            ],
            subclasses: {
                "Destruction": [{lvl: 3, name: "Primal Scream", desc: "Roar to frighten enemies within 10ft."}],
                "Nihilism": [{lvl: 3, name: "Emptiness", desc: "Immune to Charm. No need to eat/breathe."}],
                "Time": [{lvl: 3, name: "Aura of Age", desc: "Enemies within 5ft have reduced speed."}]
            },
            evolutions: [
                {name: "Bala Barrage", tier: 1}, {name: "Acidic Touch", tier: 1}, {name: "Pesquisa", tier: 1},
                {name: "Hierro Armor", tier: 5}, {name: "Cero Doble", tier: 5}, {name: "Garganta", tier: 5},
                {name: "Gran Rey Cero", tier: 9}, {name: "Los Lobos", tier: 9}
            ]
        }
    };

    /* --- INITIALIZATION --- */
    window.onload = function() {
        populateDropdown("inRace", Object.keys(RACES), "Arrancar");
        populateDropdown("inClass", Object.keys(CLASSES), "Arrancar");
        
        createStatInputs();
        createSkillInputs();
        loadClass(); // Will trigger updateSheet
    };

    function populateDropdown(id, list, def) {
        const sel = document.getElementById(id);
        sel.innerHTML = "";
        list.forEach(item => {
            const opt = document.createElement("option");
            opt.value = item;
            opt.innerText = item;
            if(item === def) opt.selected = true;
            sel.appendChild(opt);
        });
    }

    function createStatInputs() {
        const container = document.getElementById("statInputs");
        STATS.forEach(stat => {
            const div = document.createElement("div");
            div.style.marginBottom = "5px";
            div.innerHTML = `
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <label style="margin:0; width:40px; font-weight:bold;">${stat}</label>
                    <input type="number" id="in${stat}" value="${(stat==='DEX'||stat==='CON')?16:10}" 
                    style="width:60px; margin:0;" oninput="updateSheet()">
                </div>
            `;
            container.appendChild(div);
        });
    }

    function createSkillInputs() {
        const container = document.getElementById("skillInputs");
        // Saves
        container.innerHTML = "<div style='margin-bottom:5px; color:#fff; font-size:0.8rem; font-weight:bold;'>Saving Throws</div>";
        STATS.forEach(stat => {
            container.innerHTML += `
                <div style="display:flex; align-items:center; margin-bottom:2px;">
                    <input type="checkbox" id="save${stat}" style="width:auto; margin:0 8px 0 0;" onchange="updateSheet()">
                    <label style="margin:0;">${stat}</label>
                </div>`;
        });
        
        // Skills
        container.innerHTML += "<div style='margin-top:10px; margin-bottom:5px; color:#fff; font-size:0.8rem; font-weight:bold;'>Skills</div>";
        for (const [skill, stat] of Object.entries(SKILLS)) {
            const id = skill.replace(/ /g, "");
            container.innerHTML += `
                <div style="display:flex; align-items:center; margin-bottom:2px;">
                    <input type="checkbox" id="skill${id}" style="width:auto; margin:0 8px 0 0;" onchange="updateSheet()">
                    <label style="margin:0;">${skill}</label>
                </div>`;
        }
    }

    function loadClass() {
        const clsName = document.getElementById("inClass").value;
        const cls = CLASSES[clsName];

        // Populate Subclasses
        populateDropdown("inSubclass", Object.keys(cls.subclasses));

        // Create Evolutions Checkboxes
        const evoDiv = document.getElementById("evoInputs");
        evoDiv.innerHTML = "";
        if(cls.evolutions) {
            cls.evolutions.forEach((evo, idx) => {
                evoDiv.innerHTML += `
                    <div style="display:flex; align-items:center; margin-bottom:2px;">
                        <input type="checkbox" class="evo-check" value="${evo.name}" style="width:auto; margin:0 8px 0 0;" onchange="updateSheet()">
                        <label style="margin:0;">${evo.name} (T${evo.tier})</label>
                    </div>`;
            });
        }

        // Set Default Saves
        STATS.forEach(s => document.getElementById(`save${s}`).checked = false);
        cls.saves.forEach(s => document.getElementById(`save${s}`).checked = true);

        updateSheet();
    }

    /* --- UPDATE LOGIC --- */
    function getMod(score) { return Math.floor((score - 10) / 2); }
    function fmtMod(n) { return n >= 0 ? "+" + n : n; }

    function updateSheet() {
        const charName = document.getElementById("inName").value;
        const raceName = document.getElementById("inRace").value;
        const className = document.getElementById("inClass").value;
        const subclassName = document.getElementById("inSubclass").value;
        const level = parseInt(document.getElementById("inLevel").value);

        const race = RACES[raceName];
        const cls = CLASSES[className];
        const scaling = cls.scaling[level-1] || cls.scaling[19];
        const prof = scaling.prof;

        // 1. HEADER
        document.getElementById("outName").innerText = charName;
        document.getElementById("outRaceClass").innerText = `${raceName} ${className} | ${subclassName} | Level ${level}`;
        document.getElementById("outProfBonus").innerText = fmtMod(prof);
        document.getElementById("outSpeed").innerText = race.speed;
        document.getElementById("outResName").innerText = cls.resource;
        document.getElementById("outResVal").innerText = scaling.res;

        // 2. STATS & MODS
        const stats = {};
        let statsHTML = "";
        STATS.forEach(stat => {
            const val = parseInt(document.getElementById(`in${stat}`).value);
            const mod = getMod(val);
            stats[stat] = { val: val, mod: mod };

            statsHTML += `
                <div class="stat-shield">
                    <span class="stat-name">${stat}</span>
                    <span class="stat-mod">${mod}</span>
                    <span class="stat-score">${val}</span>
                </div>
            `;
        });
        document.getElementById("outStats").innerHTML = statsHTML;

        // 3. VITALS (AC, HP, INIT)
        let ac = 10 + stats.DEX.mod;
        if(className === "Arrancar") ac += stats.CON.mod; // Hierro
        document.getElementById("outAC").innerText = ac;
        document.getElementById("outInit").innerText = fmtMod(stats.DEX.mod);
        
        // HP: Max at level 1 + Avg for rest
        const hpPerLvl = (cls.hd / 2) + 1;
        const hp = cls.hd + stats.CON.mod + ((level-1) * (hpPerLvl + stats.CON.mod));
        document.getElementById("outHP").innerText = hp;

        // 4. SKILLS & SAVES WIDGETS
        let saveHTML = "";
        STATS.forEach(stat => {
            const isProf = document.getElementById(`save${stat}`).checked;
            const total = stats[stat].mod + (isProf ? prof : 0);
            saveHTML += `
                <div class="skill-row">
                    <span><span class="prof-dot ${isProf?'active':''}">${isProf?'●':'○'}</span> ${stat}</span>
                    <span>${fmtMod(total)}</span>
                </div>`;
        });
        document.getElementById("outSaves").innerHTML = saveHTML;

        let skillHTML = "";
        for(const [skill, attr] of Object.entries(SKILLS)) {
            const id = skill.replace(/ /g, "");
            const isProf = document.getElementById(`skill${id}`).checked;
            const total = stats[attr].mod + (isProf ? prof : 0);
            skillHTML += `
                <div class="skill-row">
                    <span><span class="prof-dot ${isProf?'active':''}">${isProf?'●':'○'}</span> ${skill} <small style='color:#555'>(${attr})</small></span>
                    <span>${fmtMod(total)}</span>
                </div>`;
        }
        document.getElementById("outSkills").innerHTML = skillHTML;

        // 5. MAIN CONTENT (ACTIONS & FEATURES)
        const main = document.getElementById("mainPanel");
        main.innerHTML = "";

        // A. ATTACKS SECTION
        let attacksHTML = `<h3>Attacks</h3>`;
        // Generic Unarmed
        attacksHTML += `
            <div class="action-row">
                <span class="action-name">Unarmed Strike</span>
                <span class="action-roll">Hit: ${fmtMod(stats.STR.mod + prof)} | Dmg: 1+${stats.STR.mod}</span>
            </div>`;
        
        // Arrancar Specific Attacks
        if(className === "Arrancar") {
             attacksHTML += `
            <div class="action-row" style="border-color:#00d2ff">
                <span class="action-name">Bala (Ranged)</span>
                <span class="action-roll">Hit: ${fmtMod(stats.DEX.mod + prof)} | Dmg: 1d6 Force</span>
            </div>
            <div class="action-row" style="border-color:#ff0055">
                <span class="action-name">Cero (2 Reiatsu)</span>
                <span class="action-roll">DEX Save DC ${8+prof+stats.CON.mod} | Dmg: ${scaling.extra}</span>
            </div>`;
        }
        main.innerHTML += `<div class="card">${attacksHTML}</div>`;

        // B. FEATURES
        let featHTML = `<h3>Class Features</h3>`;
        cls.features.forEach(f => {
            if(level >= f.lvl) {
                featHTML += `
                <div style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px dashed #444;">
                    <div style="font-weight:bold; color:#fff;">${f.name}</div>
                    <div class="card-desc">${f.desc}</div>
                </div>`;
            }
        });

        // Subclass
        if(cls.subclasses[subclassName]) {
            cls.subclasses[subclassName].forEach(f => {
                if(level >= f.lvl) {
                    featHTML += `
                    <div style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px dashed #444;">
                        <div style="font-weight:bold; color:var(--accent);">${f.name}</div>
                        <div class="card-desc">${f.desc}</div>
                    </div>`;
                }
            });
        }
        
        // Selected Evolutions
        const evos = document.querySelectorAll('.evo-check:checked');
        if(evos.length > 0) {
            featHTML += `<div style="margin-top:10px; font-weight:bold; color:#00d2ff;">Evolutions</div>`;
            evos.forEach(e => {
                featHTML += `<div style="font-size:0.9rem;">• ${e.value}</div>`;
            });
        }

        main.innerHTML += `<div class="card">${featHTML}</div>`;
    }
</script>

</body>
</html>
