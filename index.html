<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soul Society Builder: 5e Edition</title>
    <style>
        :root {
            --bg-dark: #0b0b0b;
            --bg-panel: #1a1a1a;
            --bg-card: #252525;
            --accent: #dc2626; /* Arrancar Red */
            --accent-sec: #00d2ff; /* Spirit Blue */
            --text-main: #e5e5e5;
            --text-dim: #a3a3a3;
            --border: #3f3f3f;
        }

        * { box-sizing: border-box; }
        body { 
            margin: 0; padding: 0; 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            font-family: 'Segoe UI', Helvetica, sans-serif;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- LEFT SIDEBAR (BUILDER) --- */
        .builder-pane {
            width: 350px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .builder-header {
            padding: 20px;
            background: #111;
            border-bottom: 1px solid var(--border);
            text-align: center;
        }
        .builder-header h2 { margin: 0; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; font-size: 1.2rem; }

        .builder-content { padding: 20px; }

        .control-group { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #333; }
        .control-group:last-child { border: none; }
        
        label { display: block; color: var(--text-dim); font-size: 0.8rem; margin-bottom: 5px; font-weight: bold; }
        
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 10px; background: #000; border: 1px solid #444; 
            color: white; border-radius: 4px; font-size: 0.9rem;
        }
        input:focus, select:focus { border-color: var(--accent); outline: none; }

        .stat-input-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .stat-input-row label { margin: 0; width: 50px; }
        .stat-input-row input { width: 60px; text-align: center; }
        .stat-input-row .racial-bonus { font-size: 0.8rem; color: var(--accent-sec); width: 40px; text-align: right; }

        /* ASI SELECTORS */
        .asi-box { background: #222; padding: 10px; border-radius: 4px; margin-bottom: 10px; border-left: 2px solid var(--accent); }
        .asi-title { font-size: 0.8rem; color: var(--accent); font-weight: bold; margin-bottom: 5px; }
        .asi-select-row { display: flex; gap: 5px; }

        /* EVOLUTION CHECKBOXES */
        .evo-item { display: flex; gap: 10px; margin-bottom: 8px; align-items: flex-start; opacity: 1; transition: opacity 0.3s; }
        .evo-item.locked { opacity: 0.3; pointer-events: none; }
        .evo-desc { font-size: 0.75rem; color: #888; margin-top: 2px; }

        /* --- RIGHT SIDE (SHEET PREVIEW) --- */
        .sheet-pane {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* HEADER CARD */
        .char-header {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
        }
        .char-identity h1 { margin: 0; font-size: 2rem; }
        .char-identity div { color: var(--text-dim); font-size: 1rem; margin-top: 5px; }

        /* VITALS ROW */
        .vitals-row { display: flex; gap: 15px; }
        .vital-card {
            background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px;
            padding: 10px; flex: 1; text-align: center;
        }
        .vital-val { font-size: 1.8rem; font-weight: bold; display: block; }
        .vital-lbl { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }

        /* STATS ROW */
        .stats-container { display: flex; gap: 10px; justify-content: space-between; }
        .stat-badge {
            background: #151515; border: 1px solid var(--border); border-radius: 6px;
            width: 100%; padding: 10px 0; text-align: center; position: relative;
        }
        .stat-badge .lbl { font-size: 0.7rem; color: #888; font-weight: bold; }
        .stat-badge .mod { font-size: 1.5rem; font-weight: bold; display: block; color: white; }
        .stat-badge .score { font-size: 0.8rem; background: #333; padding: 2px 8px; border-radius: 10px; display: inline-block; margin-top: 5px; }

        /* CONTENT GRID */
        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; height: 100%; }
        
        .panel { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 20px; }
        .panel h3 { margin-top: 0; border-bottom: 1px solid var(--border); padding-bottom: 10px; color: var(--accent); font-size: 0.9rem; text-transform: uppercase; }

        .feature-item { margin-bottom: 15px; border-bottom: 1px dashed #333; padding-bottom: 10px; }
        .feature-name { font-weight: bold; font-size: 1rem; color: #fff; }
        .feature-meta { font-size: 0.75rem; color: var(--accent-sec); margin-bottom: 5px; font-style: italic; }
        .feature-desc { font-size: 0.9rem; color: #ccc; line-height: 1.4; }

        .prof-row { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 6px; }
        .prof-row span:last-child { color: white; font-weight: bold; }
    </style>
</head>
<body>

<div class="builder-pane">
    <div class="builder-header">
        <h2>Character Config</h2>
    </div>
    <div class="builder-content">
        
        <div class="control-group">
            <label>Character Name</label>
            <input type="text" id="inName" value="Ulquiorra" oninput="updateSheet()">
        </div>

        <div class="control-group">
            <label>Race (Standard 5e)</label>
            <select id="inRace" onchange="updateSheet()">
                <option value="Human">Human (+1 All)</option>
                <option value="Elf">Elf (+2 DEX)</option>
                <option value="Dwarf">Dwarf (+2 CON)</option>
                <option value="Tiefling">Tiefling (+2 CHA, +1 INT)</option>
                <option value="Dragonborn">Dragonborn (+2 STR, +1 CHA)</option>
                <option value="Halfling">Halfling (+2 DEX)</option>
            </select>
        </div>

        <div class="control-group">
            <label>Class</label>
            <select id="inClass" disabled><option>The Arrancar</option></select>
        </div>

        <div class="control-group">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <label>Level (1-20)</label>
                <input type="number" id="inLevel" min="1" max="20" value="1" style="width:70px;" oninput="fullRefresh()">
            </div>
        </div>

        <div class="control-group">
            <label>Base Ability Scores (Before Racial/ASI)</label>
            <div id="baseStatInputs"></div>
        </div>

        <div id="asiContainer" class="control-group" style="display:none;">
            <label>Ability Score Improvements</label>
            <div id="asiInputs"></div>
        </div>

        <div class="control-group" id="subclassGroup" style="display:none;">
            <label>Aspect of Death (Subclass)</label>
            <select id="inSubclass" onchange="updateSheet()">
                <option value="Destruction">Destruction (Grimmjow)</option>
                <option value="Nihilism">Nihilism (Ulquiorra)</option>
                <option value="Madness">Madness (Szayelaporro)</option>
                <option value="Sacrifice">Sacrifice (Harribel)</option>
                <option value="Solitude">Solitude (Starrk)</option>
                <option value="Time">Time (Baraggan)</option>
            </select>
        </div>

        <div class="control-group">
            <label>Hollow Evolutions <span id="evoCount" style="color:var(--accent-sec); float:right;">0/0</span></label>
            <div id="evoList"></div>
        </div>

    </div>
</div>

<div class="sheet-pane">
    
    <div class="char-header">
        <div class="char-identity">
            <h1 id="outName">Character Name</h1>
            <div id="outRaceClass">Human Arrancar 1</div>
        </div>
        <div style="text-align:right;">
            <div style="font-size:0.8rem; color:#888;">PROFICIENCY</div>
            <div style="font-size:1.5rem; font-weight:bold; color:var(--accent);" id="outProf">+2</div>
        </div>
    </div>

    <div class="vitals-row">
        <div class="vital-card">
            <span class="vital-val" id="outAC">10</span>
            <span class="vital-lbl">Armor Class</span>
        </div>
        <div class="vital-card">
            <span class="vital-val" id="outInit">+0</span>
            <span class="vital-lbl">Initiative</span>
        </div>
        <div class="vital-card">
            <span class="vital-val" id="outSpeed">30</span>
            <span class="vital-lbl">Speed (ft)</span>
        </div>
        <div class="vital-card" style="border-color:var(--accent);">
            <span class="vital-val" id="outHP">10</span>
            <span class="vital-lbl">Hit Points</span>
        </div>
        <div class="vital-card" style="background:#222; border-color:var(--accent-sec);">
            <span class="vital-val" id="outReiatsu">2</span>
            <span class="vital-lbl">Reiatsu</span>
        </div>
    </div>

    <div class="stats-container" id="outStatsRow">
        </div>

    <div class="content-grid">
        <div class="panel">
            <h3>Class Features & Actions</h3>
            <div id="featuresList"></div>
        </div>

        <div class="panel">
            <h3>Proficiencies</h3>
            <div style="margin-bottom:15px;">
                <div style="font-size:0.8rem; font-weight:bold; margin-bottom:5px; color:var(--accent);">SAVING THROWS</div>
                <div id="outSaves"></div>
            </div>
            <div>
                <div style="font-size:0.8rem; font-weight:bold; margin-bottom:5px; color:var(--accent);">SKILLS (DEX/CON ONLY)</div>
                <div id="outSkills"></div>
            </div>
        </div>
    </div>

</div>

<script>
    /* ================= DATASETS ================= */
    
    const STATS = ["STR", "DEX", "CON", "INT", "WIS", "CHA"];
    
    const RACES = {
        "Human": { speed: 30, bonuses: { STR:1, DEX:1, CON:1, INT:1, WIS:1, CHA:1 } },
        "Elf": { speed: 30, bonuses: { DEX: 2 } },
        "Dwarf": { speed: 25, bonuses: { CON: 2 } },
        "Tiefling": { speed: 30, bonuses: { CHA: 2, INT: 1 } },
        "Dragonborn": { speed: 30, bonuses: { STR: 2, CHA: 1 } },
        "Halfling": { speed: 25, bonuses: { DEX: 2 } }
    };

    const ARRANCAR_TABLE = [
        { lvl: 1, prof: 2, reiatsu: 2, evos: 0, feat: "Hierro, Bala" },
        { lvl: 2, prof: 2, reiatsu: 3, evos: 2, feat: "Cero, Sonído" },
        { lvl: 3, prof: 2, reiatsu: 4, evos: 2, feat: "Aspect of Death" },
        { lvl: 4, prof: 2, reiatsu: 5, evos: 2, feat: "Ability Score Imp" },
        { lvl: 5, prof: 3, reiatsu: 6, evos: 3, feat: "Extra Attack" },
        { lvl: 6, prof: 3, reiatsu: 7, evos: 3, feat: "High-Speed Regen" },
        { lvl: 7, prof: 3, reiatsu: 8, evos: 4, feat: "Pesquisa" },
        { lvl: 8, prof: 3, reiatsu: 9, evos: 4, feat: "Ability Score Imp" },
        { lvl: 9, prof: 4, reiatsu: 10, evos: 5, feat: "Gran Rey Cero" },
        { lvl: 10, prof: 4, reiatsu: 11, evos: 5, feat: "Despair Aura" },
        { lvl: 11, prof: 4, reiatsu: 12, evos: 5, feat: "Resurrección" },
        { lvl: 12, prof: 4, reiatsu: 13, evos: 6, feat: "Ability Score Imp" },
        { lvl: 13, prof: 5, reiatsu: 14, evos: 6, feat: "Brutal Critical" },
        { lvl: 14, prof: 5, reiatsu: 15, evos: 6, feat: "Subclass Feature" },
        { lvl: 15, prof: 5, reiatsu: 16, evos: 7, feat: "Relentless" },
        { lvl: 16, prof: 5, reiatsu: 17, evos: 7, feat: "Ability Score Imp" },
        { lvl: 17, prof: 6, reiatsu: 18, evos: 7, feat: "-" },
        { lvl: 18, prof: 6, reiatsu: 19, evos: 8, feat: "Cero Oscuras" },
        { lvl: 19, prof: 6, reiatsu: 20, evos: 8, feat: "Ability Score Imp" },
        { lvl: 20, prof: 6, reiatsu: 25, evos: 8, feat: "Segunda Etapa" }
    ];

    const EVOLUTIONS = [
        {name: "Bala Barrage", tier: 1, desc: "Spray bullets in 10ft cube (2d4 Force)."},
        {name: "Acidic Touch", tier: 1, desc: "+1d4 Acid to melee attacks."},
        {name: "Pesquisa (Radar)", tier: 1, desc: "Blindsight 30ft."},
        {name: "Hierro Armor", tier: 5, desc: "Resistance to non-magical B/P/S."},
        {name: "Cero Doble", tier: 5, desc: "Reaction: Absorb & Reflect energy damage."},
        {name: "Garganta", tier: 5, desc: "Dimensional Storage."},
        {name: "Gran Rey Cero+", tier: 9, desc: "Cero ignores Resistance/Immunity."},
        {name: "Los Lobos", tier: 9, desc: "Summon exploding wolves."},
        {name: "Indestructible", tier: 15, desc: "Resistance to ALL damage, -10ft speed."}
    ];

    const SUBCLASSES = {
        "Destruction": { 3: "Primal Scream (Fear Aura)", 5: "Cero Stun", 11: "Pantera Form", 20: "Desgarrón" },
        "Nihilism": { 3: "Immune Charm/Sleep", 5: "Regen Buff", 11: "Murciélago (Fly)", 20: "Latigazo" },
        "Madness": { 3: "Analyze Stats", 5: "Voodoo Doll", 11: "Clone Body", 20: "Puppet Master" },
        "Sacrifice": { 3: "Phantom Currents", 5: "Ola Azul", 11: "Tiburon (Water)", 20: "Abyss Queen" },
        "Solitude": { 3: "Cero Metralleta", 5: "Quick Draw", 11: "Los Lobos (Pack)", 20: "Primary Soul" },
        "Time": { 3: "Aura of Age (Slow)", 5: "Senectud (Rot)", 11: "Arrogante", 20: "Absolute Entropy" }
    };

    /* ================= INITIALIZATION ================= */
    
    window.onload = function() {
        createBaseStatInputs();
        createEvolutions();
        fullRefresh();
    };

    function createBaseStatInputs() {
        const container = document.getElementById('baseStatInputs');
        STATS.forEach(stat => {
            container.innerHTML += `
                <div class="stat-input-row">
                    <label>${stat}</label>
                    <input type="number" id="base${stat}" value="${(stat==='DEX'||stat==='CON')?15:10}" oninput="updateSheet()">
                    <span class="racial-bonus" id="raceBonus${stat}">+0</span>
                </div>
            `;
        });
    }

    function createEvolutions() {
        const container = document.getElementById('evoList');
        EVOLUTIONS.forEach((evo, idx) => {
            container.innerHTML += `
                <div class="evo-item" id="evoRow${idx}">
                    <input type="checkbox" id="evoCheck${idx}" onchange="updateSheet()">
                    <div>
                        <div style="font-weight:bold; font-size:0.85rem;">${evo.name} <span style="color:var(--accent); font-size:0.7rem;">Tier ${evo.tier}</span></div>
                        <div class="evo-desc">${evo.desc}</div>
                    </div>
                </div>
            `;
        });
    }

    /* ================= LOGIC CORE ================= */

    function fullRefresh() {
        renderASIInputs();
        updateSheet();
    }

    function renderASIInputs() {
        const lvl = parseInt(document.getElementById('inLevel').value);
        const container = document.getElementById('asiInputs');
        const wrapper = document.getElementById('asiContainer');
        
        container.innerHTML = "";
        const asiLevels = [4, 8, 12, 16, 19];
        
        let hasASI = false;

        asiLevels.forEach(milestone => {
            if (lvl >= milestone) {
                hasASI = true;
                let html = `
                    <div class="asi-box">
                        <div class="asi-title">Level ${milestone} Bonus</div>
                        <div class="asi-select-row">
                            <select id="asi${milestone}_1" onchange="updateSheet()">
                                <option value="">--</option>
                                ${STATS.map(s => `<option value="${s}">${s} +1</option>`).join('')}
                            </select>
                            <select id="asi${milestone}_2" onchange="updateSheet()">
                                <option value="">--</option>
                                ${STATS.map(s => `<option value="${s}">${s} +1</option>`).join('')}
                            </select>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            }
        });

        wrapper.style.display = hasASI ? "block" : "none";
    }

    function getCalculatedStats() {
        const raceName = document.getElementById('inRace').value;
        const race = RACES[raceName];
        
        let totals = {};
        
        // 1. Base + Race
        STATS.forEach(stat => {
            let base = parseInt(document.getElementById(`base${stat}`).value) || 10;
            let bonus = race.bonuses[stat] || 0;
            
            // Update UI for racial bonus
            document.getElementById(`raceBonus${stat}`).innerText = bonus > 0 ? `+${bonus}` : "";
            
            totals[stat] = base + bonus;
        });

        // 2. ASI Additions
        const lvl = parseInt(document.getElementById('inLevel').value);
        const asiLevels = [4, 8, 12, 16, 19];
        asiLevels.forEach(milestone => {
            if (lvl >= milestone) {
                const sel1 = document.getElementById(`asi${milestone}_1`);
                const sel2 = document.getElementById(`asi${milestone}_2`);
                if (sel1 && sel1.value) totals[sel1.value]++;
                if (sel2 && sel2.value) totals[sel2.value]++;
            }
        });

        return totals;
    }

    function getMod(score) { return Math.floor((score - 10) / 2); }
    function fmtMod(n) { return n >= 0 ? "+" + n : n; }

    function updateSheet() {
        const lvl = parseInt(document.getElementById('inLevel').value);
        const name = document.getElementById('inName').value;
        const raceName = document.getElementById('inRace').value;
        const subclass = document.getElementById('inSubclass').value;
        const race = RACES[raceName];
        const data = ARRANCAR_TABLE[lvl - 1];
        
        // 1. Header Logic
        document.getElementById('outName').innerText = name;
        document.getElementById('outRaceClass').innerText = `${raceName} Arrancar | ${lvl >=3 ? subclass : "No Aspect"} | Level ${lvl}`;
        document.getElementById('outProf').innerText = fmtMod(data.prof);
        document.getElementById('outSpeed').innerText = race.speed;

        // 2. Subclass Visibility
        document.getElementById('subclassGroup').style.display = (lvl >= 3) ? "block" : "none";

        // 3. Stats Calculation & Rendering
        const stats = getCalculatedStats();
        const container = document.getElementById('outStatsRow');
        container.innerHTML = "";
        
        STATS.forEach(stat => {
            const val = stats[stat];
            const mod = getMod(val);
            container.innerHTML += `
                <div class="stat-badge">
                    <span class="lbl">${stat}</span>
                    <span class="mod">${fmtMod(mod)}</span>
                    <span class="score">${val}</span>
                </div>
            `;
        });

        // 4. Vitals
        // Hierro: 10 + DEX + CON
        const ac = 10 + getMod(stats.DEX) + getMod(stats.CON);
        document.getElementById('outAC').innerText = ac;
        document.getElementById('outInit').innerText = fmtMod(getMod(stats.DEX));
        
        // HP: (10 + CON) + (Level-1)*(6 + CON)
        const conMod = getMod(stats.CON);
        const hp = (10 + conMod) + ((lvl - 1) * (6 + conMod));
        document.getElementById('outHP').innerText = hp;
        document.getElementById('outReiatsu').innerText = data.reiatsu;

        // 5. Evolutions Handling
        let evoCount = 0;
        const maxEvos = data.evos;
        
        // Count checked
        EVOLUTIONS.forEach((evo, idx) => {
            const cb = document.getElementById(`evoCheck${idx}`);
            const row = document.getElementById(`evoRow${idx}`);
            
            // Tier Logic
            if (lvl < evo.tier) {
                row.classList.add('locked');
                cb.checked = false;
                cb.disabled = true;
            } else {
                row.classList.remove('locked');
                cb.disabled = false;
            }

            if (cb.checked) evoCount++;
        });

        // Limit Logic
        document.getElementById('evoCount').innerText = `${evoCount}/${maxEvos}`;
        if (evoCount >= maxEvos) {
            EVOLUTIONS.forEach((evo, idx) => {
                const cb = document.getElementById(`evoCheck${idx}`);
                if (!cb.checked) cb.disabled = true;
            });
        }

        // 6. Features & Actions List (Construction)
        const featBox = document.getElementById('featuresList');
        featBox.innerHTML = "";

        // Core Actions
        const balaDmg = lvl >= 11 ? "1d10" : lvl >= 5 ? "1d8" : "1d6";
        const ceroDmg = lvl >= 20 ? "10d10" : (lvl >= 17 ? "7d10" : (lvl >= 9 ? "4d10" : (lvl >= 5 ? "2d10" : "1d10")));

        // Add Actions Cards
        featBox.innerHTML += renderFeatCard("Bala", "Action/Bonus", `Ranged Spell Attack. ${fmtMod(getMod(stats.DEX) + data.prof)} to hit. Deals ${balaDmg} Force damage.`);
        if (lvl >= 2) featBox.innerHTML += renderFeatCard("Cero (2 Reiatsu)", "Action", `100ft Line/30ft Cone. DEX Save DC ${8 + data.prof + conMod}. Damage: ${ceroDmg} Force.`);
        if (lvl >= 2) featBox.innerHTML += renderFeatCard("Sonído (1 Reiatsu)", "Bonus Action", "Teleport 30ft to unoccupied space.");
        if (lvl >= 6) featBox.innerHTML += renderFeatCard("High-Speed Regen", "Bonus Action", "Spend Reiatsu. Heal 1d10 per point.");

        // Subclass Features
        if (lvl >= 3) {
            const subFeats = SUBCLASSES[subclass];
            Object.keys(subFeats).forEach(fLvl => {
                if (lvl >= parseInt(fLvl)) {
                    featBox.innerHTML += renderFeatCard(subFeats[fLvl], `${subclass} Feature`, "See subclass description.");
                }
            });
        }

        // Active Evolutions
        EVOLUTIONS.forEach((evo, idx) => {
            if (document.getElementById(`evoCheck${idx}`).checked) {
                 featBox.innerHTML += renderFeatCard(evo.name, "Evolution", evo.desc);
            }
        });

        // 7. Saves & Skills (Simple)
        const saveBox = document.getElementById('outSaves');
        saveBox.innerHTML = `
            <div class="prof-row"><span>CON Save</span><span>${fmtMod(conMod + data.prof)}</span></div>
            <div class="prof-row"><span>DEX Save</span><span>${fmtMod(getMod(stats.DEX) + data.prof)}</span></div>
        `;
    }

    function renderFeatCard(title, meta, desc) {
        return `
            <div class="feature-item">
                <div class="feature-name">${title}</div>
                <div class="feature-meta">${meta}</div>
                <div class="feature-desc">${desc}</div>
            </div>
        `;
    }

</script>

</body>
</html>
