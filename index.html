<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA G.O.A.T Draft Simulator</title>
    
    <!-- Tailwind CSS for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons (Global Script) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Import Map for Firebase -->
    <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>

    <script type="text/babel" data-type="module">
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
        import { getFirestore, collection, doc, setDoc, onSnapshot, getDoc } from 'firebase/firestore';

        // --- Icons Component Wrapper ---
        // Since we are in raw HTML, we use the lucide global object or simple SVG placeholders
        const Icon = ({ name, className }) => {
            // Simple fallback icons using emoji if Lucide isn't bundled
            const icons = {
                Trophy: 'üèÜ',
                Users: 'üë•',
                Play: '‚ñ∂Ô∏è',
                RotateCcw: 'üîÑ',
                Crown: 'üëë',
                Shield: 'üõ°Ô∏è',
                Activity: 'üìà',
                ChevronRight: '>',
                BarChart2: 'üìä'
            };
            return <span className={className}>{icons[name] || '?'}</span>;
        };

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyDCrKQVcGBW4iy7OMAtn4Jcf1ot5CGALBE",
            authDomain: "highnoon-66ee0.firebaseapp.com",
            databaseURL: "https://highnoon-66ee0-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "highnoon-66ee0",
            storageBucket: "highnoon-66ee0.firebasestorage.app",
            messagingSenderId: "754268761672",
            appId: "1:754268761672:web:7fbf59d2c403b43356727d"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'default-app-id';

        // --- Player Database ---
        const PLAYERS = [
            // CHAMPIONS POOL
            { id: 'shaq', name: "Shaquille O'Neal", pos: 'C', type: 'CHAMPION', ratings: { off: 99, def: 88, reb: 99, play: 60, clutch: 85 }, img: "üõ°Ô∏è" },
            { id: 'hakeem', name: "Hakeem Olajuwon", pos: 'C', type: 'CHAMPION', ratings: { off: 94, def: 99, reb: 95, play: 70, clutch: 90 }, img: "üõ°Ô∏è" },
            { id: 'lebron', name: "LeBron James", pos: 'SF', type: 'CHAMPION', ratings: { off: 98, def: 92, reb: 85, play: 99, clutch: 92 }, img: "üëë" },
            { id: 'jordan', name: "Michael Jordan", pos: 'SG', type: 'CHAMPION', ratings: { off: 99, def: 95, reb: 70, play: 80, clutch: 99 }, img: "üëë" },
            { id: 'duncan', name: "Tim Duncan", pos: 'PF', type: 'CHAMPION', ratings: { off: 90, def: 96, reb: 92, play: 75, clutch: 88 }, img: "üõ°Ô∏è" },
            { id: 'kobe', name: "Kobe Bryant", pos: 'SG', type: 'CHAMPION', ratings: { off: 98, def: 90, reb: 60, play: 75, clutch: 98 }, img: "üëë" },
            { id: 'curry', name: "Stephen Curry", pos: 'PG', type: 'CHAMPION', ratings: { off: 99, def: 65, reb: 50, play: 90, clutch: 95 }, img: "üéØ" },
            { id: 'giannis', name: "Giannis Antetokounmpo", pos: 'PF', type: 'CHAMPION', ratings: { off: 95, def: 92, reb: 95, play: 70, clutch: 80 }, img: "üí™" },

            // RINGLESS POOL
            { id: 'malone', name: "Karl Malone", pos: 'PF', type: 'RINGLESS', ratings: { off: 94, def: 85, reb: 95, play: 65, clutch: 80 }, img: "üì¨" },
            { id: 'barkley', name: "Charles Barkley", pos: 'PF', type: 'RINGLESS', ratings: { off: 93, def: 75, reb: 98, play: 75, clutch: 85 }, img: "üç©" },
            { id: 'iverson', name: "Allen Iverson", pos: 'SG', type: 'RINGLESS', ratings: { off: 96, def: 70, reb: 40, play: 75, clutch: 92 }, img: "‚ö°" },
            { id: 'stockton', name: "John Stockton", pos: 'PG', type: 'RINGLESS', ratings: { off: 80, def: 85, reb: 40, play: 99, clutch: 85 }, img: "üñêÔ∏è" },
            { id: 'nash', name: "Steve Nash", pos: 'PG', type: 'RINGLESS', ratings: { off: 90, def: 50, reb: 40, play: 99, clutch: 88 }, img: "üéØ" },
            { id: 'harden', name: "James Harden", pos: 'SG', type: 'RINGLESS', ratings: { off: 97, def: 60, reb: 60, play: 92, clutch: 82 }, img: "üßî" },
            { id: 'ewing', name: "Patrick Ewing", pos: 'C', type: 'RINGLESS', ratings: { off: 88, def: 92, reb: 90, play: 50, clutch: 80 }, img: "ü¶ç" },
            { id: 'reggie', name: "Reggie Miller", pos: 'SG', type: 'RINGLESS', ratings: { off: 88, def: 60, reb: 40, play: 60, clutch: 98 }, img: "üëå" },
            { id: 'cp3', name: "Chris Paul", pos: 'PG', type: 'RINGLESS', ratings: { off: 88, def: 85, reb: 50, play: 98, clutch: 90 }, img: "üß†" },
            { id: 'tmac', name: "Tracy McGrady", pos: 'SF', type: 'RINGLESS', ratings: { off: 95, def: 70, reb: 65, play: 75, clutch: 88 }, img: "üöÄ" },
            { id: 'wilkins', name: "Dominique Wilkins", pos: 'SF', type: 'RINGLESS', ratings: { off: 92, def: 65, reb: 70, play: 50, clutch: 85 }, img: "üé¨" },
            { id: 'melo', name: "Carmelo Anthony", pos: 'SF', type: 'RINGLESS', ratings: { off: 94, def: 60, reb: 70, play: 55, clutch: 90 }, img: "üç¨" },
            { id: 'westbrook', name: "Russell Westbrook", pos: 'PG', type: 'RINGLESS', ratings: { off: 90, def: 70, reb: 85, play: 90, clutch: 85 }, img: "üò§" },
            { id: 'lillard', name: "Damian Lillard", pos: 'PG', type: 'RINGLESS', ratings: { off: 92, def: 55, reb: 45, play: 80, clutch: 99 }, img: "‚åö" },
            { id: 'baylor', name: "Elgin Baylor", pos: 'SF', type: 'RINGLESS', ratings: { off: 94, def: 75, reb: 90, play: 70, clutch: 85 }, img: "‚úàÔ∏è" },
            { id: 'mutombo', name: "Dikembe Mutombo", pos: 'C', type: 'RINGLESS', ratings: { off: 60, def: 98, reb: 92, play: 40, clutch: 70 }, img: "‚òùÔ∏è" },
            { id: 'hill', name: "Grant Hill", pos: 'SF', type: 'RINGLESS', ratings: { off: 88, def: 75, reb: 75, play: 85, clutch: 80 }, img: "üßä" },
            { id: 'vince', name: "Vince Carter", pos: 'SG', type: 'RINGLESS', ratings: { off: 90, def: 65, reb: 60, play: 65, clutch: 88 }, img: "üõ∏" },
            { id: 'king', name: "Bernard King", pos: 'SF', type: 'RINGLESS', ratings: { off: 93, def: 60, reb: 60, play: 55, clutch: 85 }, img: "üëë" },
            { id: 'maravich', name: "Pete Maravich", pos: 'SG', type: 'RINGLESS', ratings: { off: 88, def: 50, reb: 45, play: 90, clutch: 85 }, img: "üî´" },
            { id: 'stoudemire', name: "Amare Stoudemire", pos: 'PF', type: 'RINGLESS', ratings: { off: 92, def: 65, reb: 85, play: 50, clutch: 80 }, img: "üëì" }
        ];

        function NBADraftSim() {
            const [user, setUser] = React.useState(null);
            const [gameMode, setGameMode] = React.useState('draft'); // draft, sim, results
            const [teams, setTeams] = React.useState({
                teamA: { name: 'Team Bobertings', players: [] },
                teamB: { name: 'Team Jokstars', players: [] }
            });
            const [turn, setTurn] = React.useState('teamA');
            const [draftPool, setDraftPool] = React.useState(PLAYERS);
            const [simResults, setSimResults] = React.useState([]);
            const [currentSimGame, setCurrentSimGame] = React.useState(0);
            const [simLog, setSimLog] = React.useState([]);

            // --- Authentication ---
            React.useEffect(() => {
                const initAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously");
                    } catch (e) {
                        console.error("Auth failed:", e);
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, setUser);
                return () => unsubscribe();
            }, []);

            // --- Draft Logic ---
            const handleDraftPick = (player) => {
                const currentTeamPlayers = teams[turn].players;
                const hasChampion = currentTeamPlayers.some(p => p.type === 'CHAMPION');

                if (!hasChampion && player.type !== 'CHAMPION') {
                    alert("You must draft a CHAMPION first!");
                    return;
                }
                if (hasChampion && player.type === 'CHAMPION') {
                    alert("You already have a Champion! Draft from the Ringless pool.");
                    return;
                }
                if (currentTeamPlayers.length >= 6) {
                    alert("Roster full!");
                    return;
                }

                const newTeams = { ...teams };
                newTeams[turn].players.push(player);
                setTeams(newTeams);

                setDraftPool(draftPool.filter(p => p.id !== player.id));

                if (newTeams.teamA.players.length === 1 && newTeams.teamB.players.length === 0) {
                    setTurn('teamB');
                } else if (newTeams.teamA.players.length === 1 && newTeams.teamB.players.length === 1) {
                    setTurn('teamB');
                } else {
                    setTurn(turn === 'teamA' ? 'teamB' : 'teamA');
                }

                if (newTeams.teamA.players.length === 6 && newTeams.teamB.players.length === 6) {
                    setGameMode('sim');
                }
            };

            // --- Simulation Logic ---
            const calculateTeamStats = (teamPlayers) => {
                return teamPlayers.reduce((acc, p) => {
                    acc.off += p.ratings.off;
                    acc.def += p.ratings.def;
                    acc.reb += p.ratings.reb;
                    acc.clutch += p.ratings.clutch;
                    return acc;
                }, { off: 0, def: 0, reb: 0, clutch: 0 });
            };

            const simulateGame = () => {
                if (currentSimGame >= 7) return;

                const statsA = calculateTeamStats(teams.teamA.players);
                const statsB = calculateTeamStats(teams.teamB.players);
                const varianceA = Math.floor(Math.random() * 20) - 10;
                const varianceB = Math.floor(Math.random() * 20) - 10;

                let scoreA = 80 + (statsA.off * 0.1) + (statsA.clutch * 0.05) - (statsB.def * 0.05) + varianceA;
                let scoreB = 80 + (statsB.off * 0.1) + (statsB.clutch * 0.05) - (statsA.def * 0.05) + varianceB;

                if (statsA.reb > statsB.reb + 20) scoreA += 4;
                if (statsB.reb > statsA.reb + 20) scoreB += 4;

                scoreA = Math.round(scoreA);
                scoreB = Math.round(scoreB);
                if (scoreA === scoreB) scoreA += 2;

                const winner = scoreA > scoreB ? 'teamA' : 'teamB';
                const winningTeam = winner === 'teamA' ? teams.teamA : teams.teamB;
                const mvpPlayer = winningTeam.players.reduce((prev, current) => 
                    (prev.ratings.off + Math.random() * prev.ratings.clutch) > (current.ratings.off + Math.random() * current.ratings.clutch) ? prev : current
                );

                const newResult = {
                    game: currentSimGame + 1,
                    scoreA,
                    scoreB,
                    winner,
                    mvp: mvpPlayer.name
                };

                setSimResults([...simResults, newResult]);
                setCurrentSimGame(currentSimGame + 1);
            };

            const resetGame = () => {
                setTeams({ teamA: { name: 'Team Bobertings', players: [] }, teamB: { name: 'Team Jokstars', players: [] } });
                setDraftPool(PLAYERS);
                setGameMode('draft');
                setSimResults([]);
                setCurrentSimGame(0);
                setTurn('teamA');
            };

            // --- Components ---
            const PlayerCard = ({ player, onClick }) => (
                <div onClick={() => onClick(player)} className={`cursor-pointer border-2 rounded-lg p-3 flex flex-col items-center justify-center transition-all hover:scale-105 ${player.type === 'CHAMPION' ? 'border-yellow-400 bg-yellow-50' : 'border-gray-300 bg-white'} hover:border-blue-500 shadow-sm`}>
                    <div className="text-2xl mb-2">{player.img}</div>
                    <div className="font-bold text-sm text-center text-slate-800">{player.name}</div>
                    <div className="text-xs text-gray-500">{player.pos}</div>
                    <div className={`text-xs px-2 py-0.5 rounded-full mt-1 ${player.type === 'CHAMPION' ? 'bg-yellow-200 text-yellow-800' : 'bg-gray-200 text-gray-800'}`}>
                        {player.type === 'CHAMPION' ? 'üèÜ Champ' : 'üíç Ringless'}
                    </div>
                </div>
            );

            const TeamRoster = ({ team }) => (
                <div className="bg-slate-800 text-white p-4 rounded-xl shadow-lg min-h-[200px]">
                    <h3 className="font-bold text-lg mb-3 border-b border-slate-600 pb-2 flex justify-between">
                        {team.name}
                        <span className="text-xs bg-slate-600 px-2 py-1 rounded">{team.players.length}/6</span>
                    </h3>
                    <div className="space-y-2">
                        {team.players.map((p, i) => (
                            <div key={i} className="flex items-center justify-between bg-slate-700 p-2 rounded">
                                <span className="flex items-center gap-2">
                                    <span>{p.img}</span>
                                    <span className="font-medium text-sm">{p.name}</span>
                                </span>
                                <span className="text-xs font-bold text-slate-400">{p.pos}</span>
                            </div>
                        ))}
                        {Array.from({ length: Math.max(0, 6 - team.players.length) }).map((_, i) => (
                            <div key={`empty-${i}`} className="border-2 border-dashed border-slate-600 p-2 rounded text-center text-xs text-slate-500">
                                Empty Slot
                            </div>
                        ))}
                    </div>
                </div>
            );

            // --- Main Render ---
            if (gameMode === 'draft') {
                return (
                    <div className="min-h-screen bg-slate-100 p-4">
                        <div className="max-w-6xl mx-auto">
                            <header className="flex justify-between items-center mb-6">
                                <h1 className="text-3xl font-black text-slate-800 flex items-center gap-2">
                                    <Icon name="Trophy" className="text-yellow-500" /> NBA G.O.A.T Draft
                                </h1>
                                <div className="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold shadow-md animate-pulse">
                                    Current Pick: {teams[turn].name}
                                </div>
                            </header>
                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                                <div className="lg:col-span-3"><TeamRoster team={teams.teamA} /></div>
                                <div className="lg:col-span-6">
                                    <div className="bg-white p-4 rounded-xl shadow-lg">
                                        <div className="mb-6">
                                            <h3 className="text-xs font-bold text-yellow-600 uppercase mb-2">Champions (Draft First)</h3>
                                            <div className="grid grid-cols-3 gap-2">
                                                {draftPool.filter(p => p.type === 'CHAMPION').map(p => <PlayerCard key={p.id} player={p} onClick={handleDraftPick} />)}
                                            </div>
                                        </div>
                                        <div>
                                            <h3 className="text-xs font-bold text-slate-500 uppercase mb-2">Legends (Ringless)</h3>
                                            <div className="grid grid-cols-3 gap-2">
                                                {draftPool.filter(p => p.type === 'RINGLESS').map(p => <PlayerCard key={p.id} player={p} onClick={handleDraftPick} />)}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="lg:col-span-3"><TeamRoster team={teams.teamB} /></div>
                            </div>
                        </div>
                    </div>
                );
            }

            const teamAWins = simResults.filter(r => r.winner === 'teamA').length;
            const teamBWins = simResults.filter(r => r.winner === 'teamB').length;
            const seriesOver = teamAWins === 4 || teamBWins === 4;

            return (
                <div className="min-h-screen bg-slate-900 text-white p-6 flex flex-col items-center">
                    <div className="max-w-4xl w-full">
                        <header className="text-center mb-10">
                            <h1 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-red-500">FINALS SIMULATION</h1>
                            <div className="flex justify-center items-center gap-10 mt-6">
                                <div className="text-center">
                                    <h2 className="text-2xl font-bold">{teams.teamA.name}</h2>
                                    <div className="text-6xl font-mono font-bold text-blue-400">{teamAWins}</div>
                                </div>
                                <div className="text-xl text-gray-500 font-bold">VS</div>
                                <div className="text-center">
                                    <h2 className="text-2xl font-bold">{teams.teamB.name}</h2>
                                    <div className="text-6xl font-mono font-bold text-red-400">{teamBWins}</div>
                                </div>
                            </div>
                        </header>

                        <div className="flex flex-col justify-center items-center gap-4 mb-8">
                            {!seriesOver ? (
                                <button onClick={simulateGame} className="flex items-center gap-2 bg-green-600 hover:bg-green-500 text-white px-8 py-4 rounded-full font-bold text-xl shadow-lg transition-all hover:scale-105">
                                    <Icon name="Play" /> SIMULATE GAME {currentSimGame + 1}
                                </button>
                            ) : (
                                <div className="text-center animate-bounce">
                                    <h2 className="text-3xl font-bold text-yellow-400 mb-4">
                                        {teamAWins > teamBWins ? teams.teamA.name : teams.teamB.name} WINS!
                                    </h2>
                                    <button onClick={resetGame} className="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 px-6 py-2 rounded-lg mx-auto">
                                        <Icon name="RotateCcw" /> Restart Draft
                                    </button>
                                </div>
                            )}
                        </div>

                        <div className="bg-black/30 rounded-xl p-6 min-h-[200px]">
                            <h3 className="font-bold text-gray-400 mb-4 flex items-center gap-2"><Icon name="Activity" /> Series Log</h3>
                            <div className="space-y-3">
                                {simResults.map((res, idx) => (
                                    <div key={idx} className="flex items-center gap-4 p-3 bg-slate-800 rounded border-l-4 border-blue-500">
                                        <div className="font-mono font-bold text-lg text-gray-500">G{res.game}</div>
                                        <div className="flex-1">
                                            <div className="flex justify-between font-bold"><span>{teams.teamA.name}</span><span>{res.scoreA}</span></div>
                                            <div className="flex justify-between text-gray-400"><span>{teams.teamB.name}</span><span>{res.scoreB}</span></div>
                                        </div>
                                        <div className="text-xs bg-slate-900 px-2 py-1 rounded text-yellow-500">MVP: {res.mvp}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<NBADraftSim />);
    </script>
</body>
</html>
