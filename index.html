<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bleach 5e: Hero's Diary</title>
    <style>
        :root {
            --bg: #121212;
            --panel: #1e1e1e;
            --input-bg: #2d2d2d;
            --text: #e0e0e0;
            --accent: #d8b85e; /* Gold/Paper accent */
            --accent-glow: #00d2ff; /* Spirit energy */
            --border: #444;
            --sheet-bg: #fdfbf7;
            --sheet-text: #222;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; height: 100vh; overflow: hidden; }

        /* --- LAYOUT --- */
        .app-container { display: grid; grid-template-columns: 400px 1fr; width: 100%; height: 100%; }
        
        /* SIDEBAR (EDITOR) */
        .editor { background: var(--panel); padding: 20px; overflow-y: auto; border-right: 1px solid var(--border); box-shadow: 2px 0 10px rgba(0,0,0,0.5); }
        .editor h2 { color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; color: #aaa; margin-bottom: 5px; }
        input, select, textarea { width: 100%; background: var(--input-bg); border: 1px solid var(--border); color: white; padding: 8px; border-radius: 4px; box-sizing: border-box; }
        input:focus, select:focus { border-color: var(--accent); outline: none; }

        .stat-row { display: flex; gap: 10px; align-items: center; margin-bottom: 8px; }
        .stat-row label { width: 40px; margin: 0; font-weight: bold; color: white; }
        .stat-row input { text-align: center; font-weight: bold; }
        
        .skill-list { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.8rem; }
        .skill-item { display: flex; align-items: center; gap: 5px; }
        .skill-item input { width: auto; }

        /* PREVIEW AREA */
        .preview { background: #333; padding: 40px; overflow-y: auto; display: flex; justify-content: center; }

        /* SHEET DESIGN (THE PAPER) */
        .sheet {
            background: var(--sheet-bg);
            color: var(--sheet-text);
            width: 850px;
            min-height: 1100px;
            padding: 50px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            font-family: 'Georgia', serif;
            position: relative;
        }

        .sheet-header { display: flex; justify-content: space-between; border-bottom: 3px solid var(--sheet-text); padding-bottom: 15px; margin-bottom: 30px; }
        .char-name { font-size: 2.5rem; font-weight: bold; font-family: sans-serif; text-transform: uppercase; letter-spacing: -1px; }
        .char-details { display: flex; gap: 20px; font-family: sans-serif; font-size: 0.9rem; text-transform: uppercase; margin-top: 10px; }
        
        .top-stats { display: flex; gap: 15px; justify-content: space-between; margin-bottom: 30px; }
        .bubble { border: 2px solid #333; border-radius: 10px; padding: 10px; text-align: center; min-width: 60px; background: white; }
        .bubble small { display: block; font-size: 0.6rem; text-transform: uppercase; color: #666; font-family: sans-serif; }
        .bubble span { font-size: 1.4rem; font-weight: bold; display: block; }

        .main-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 40px; }
        
        /* Attributes Column */
        .attr-box { background: #eee; border-radius: 8px; padding: 10px; text-align: center; margin-bottom: 15px; border: 1px solid #ccc; }
        .attr-label { font-weight: bold; text-transform: uppercase; font-size: 0.8rem; font-family: sans-serif; }
        .attr-mod { font-size: 1.8rem; font-weight: bold; display: block; margin: 5px 0; }
        .attr-score { font-size: 0.9rem; background: white; border: 1px solid #aaa; border-radius: 10px; padding: 2px 8px; display: inline-block; }

        .prof-box { margin-bottom: 20px; font-size: 0.9rem; }
        .prof-row { display: flex; justify-content: space-between; border-bottom: 1px solid #ddd; padding: 3px 0; }
        .prof-row.checked { font-weight: bold; color: #000; }
        .prof-row span:first-child { width: 20px; text-align: center; }

        /* Features Column */
        .feature-section h3 { border-bottom: 2px solid #000; font-family: sans-serif; text-transform: uppercase; margin-top: 0; }
        .feature-item { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #ccc; }
        .feature-title { font-weight: bold; font-size: 1.1rem; }
        .feature-meta { font-size: 0.8rem; color: #666; font-style: italic; margin-bottom: 4px; }
        .feature-desc { font-size: 0.9rem; line-height: 1.4; }

        /* PRINT */
        @media print {
            body { height: auto; overflow: visible; background: white; }
            .editor { display: none; }
            .preview { padding: 0; background: white; display: block; }
            .sheet { box-shadow: none; width: 100%; margin: 0; padding: 0; }
            .app-container { display: block; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="editor">
        <h1 style="text-align:center; color:white;">HERO'S DIARY</h1>
        
        <h2>Identity</h2>
        <div class="form-group"><label>Character Name</label><input type="text" id="name" value="Grimmjow" oninput="render()"></div>
        <div class="form-group">
            <label>Race</label>
            <select id="race" onchange="render()">
                </select>
        </div>
        <div class="form-group">
            <label>Class</label>
            <select id="charClass" onchange="changeClass()">
                </select>
        </div>
        <div class="form-group">
            <label>Subclass</label>
            <select id="subclass" onchange="render()">
                </select>
        </div>
        <div class="form-group"><label>Level</label><input type="number" id="level" value="1" min="1" max="20" oninput="render()"></div>

        <h2>Ability Scores</h2>
        <div id="statsInputs">
            </div>

        <h2>Proficiencies</h2>
        <div class="form-group">
            <label>Saving Throws (Check Class Def)</label>
            <div class="skill-list" id="saveInputs">
                </div>
        </div>
        <div class="form-group">
            <label>Skills</label>
            <div class="skill-list" id="skillInputs">
                </div>
        </div>

        <div id="classSpecificOptions">
            <h2>Hollow Evolutions</h2>
            <div id="evoList" class="skill-list" style="grid-template-columns: 1fr;"></div>
        </div>

        <button onclick="window.print()" style="width:100%; padding: 15px; background: var(--accent); border:none; font-weight:bold; cursor:pointer; margin-top:20px;">PRINT CHARACTER SHEET</button>
    </div>

    <div class="preview">
        <div class="sheet">
            <div class="sheet-header">
                <div>
                    <div class="char-name" id="sheetName"></div>
                    <div class="char-details">
                        <span id="sheetRaceClass"></span> | <span id="sheetSubclass"></span> | Level <span id="sheetLevel"></span>
                    </div>
                </div>
                <div style="text-align: right;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Dungeons_and_Dragons_5-character_logo.svg/1200px-Dungeons_and_Dragons_5-character_logo.svg.png" style="height: 50px; opacity: 0.5;">
                </div>
            </div>

            <div class="top-stats">
                <div class="bubble"><small>Armor Class</small><span id="sheetAC">10</span></div>
                <div class="bubble"><small>Initiative</small><span id="sheetInit">+0</span></div>
                <div class="bubble"><small>Speed</small><span id="sheetSpeed">30ft</span></div>
                <div class="bubble"><small>Hit Points</small><span id="sheetHP">10</span></div>
                <div class="bubble"><small>Hit Dice</small><span id="sheetHD">1d10</span></div>
                <div class="bubble"><small>Proficiency</small><span id="sheetProf">+2</span></div>
                <div class="bubble"><small>Passive Perception</small><span id="sheetPP">10</span></div>
            </div>

            <div class="main-grid">
                <div>
                    <div id="sheetStats">
                        </div>

                    <div class="prof-box">
                        <h4 style="border-bottom: 1px solid #000;">SAVING THROWS</h4>
                        <div id="sheetSaves"></div>
                    </div>

                    <div class="prof-box">
                        <h4 style="border-bottom: 1px solid #000;">SKILLS</h4>
                        <div id="sheetSkills"></div>
                    </div>

                    <div class="attr-box" style="background: #222; color: white; border: 2px solid var(--accent);">
                        <span class="attr-label" style="color: var(--accent);">Class Resource</span>
                        <span class="attr-mod" id="sheetResourceVal">--</span>
                        <span class="attr-score" id="sheetResourceName" style="color:black">--</span>
                    </div>
                </div>

                <div class="feature-section">
                    <h3>Class Features & Traits</h3>
                    <div id="sheetFeatures">
                        </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    /* =========================================
       DATA: RACES
       ========================================= */
    const RACES = {
        "Human": { speed: 30, size: "Medium", traits: ["Versatile: Gain a Feat (Manual Add)"] },
        "Plus Soul": { speed: 30, size: "Medium", traits: ["Spirit Sight: Can see spirits."] },
        "Hollow": { speed: 40, size: "Large", traits: ["Mask: Advantage on Intimidation."] }
    };

    /* =========================================
       DATA: CLASSES (THE ARRANCAR)
       ========================================= */
    const CLASSES = {
        "Arrancar": {
            hd: 10,
            primary: "CON",
            saves: ["CON", "DEX"],
            subclassLabel: "Aspect of Death",
            scaling: [
                { lvl: 1, prof: 2, reiatsu: 2, cero: '1d10', evos: 0 },
                { lvl: 2, prof: 2, reiatsu: 3, cero: '1d10', evos: 2 },
                { lvl: 3, prof: 2, reiatsu: 4, cero: '2d10', evos: 2 },
                { lvl: 4, prof: 2, reiatsu: 5, cero: '2d10', evos: 2 },
                { lvl: 5, prof: 3, reiatsu: 6, cero: '2d10', evos: 3 },
                { lvl: 6, prof: 3, reiatsu: 7, cero: '3d10', evos: 3 },
                { lvl: 7, prof: 3, reiatsu: 8, cero: '3d10', evos: 4 },
                { lvl: 8, prof: 3, reiatsu: 9, cero: '3d10', evos: 4 },
                { lvl: 9, prof: 4, reiatsu: 10, cero: '4d10', evos: 5 },
                { lvl: 10, prof: 4, reiatsu: 11, cero: '4d10', evos: 5 },
                { lvl: 11, prof: 4, reiatsu: 12, cero: '5d10', evos: 5 },
                { lvl: 12, prof: 4, reiatsu: 13, cero: '5d10', evos: 6 },
                { lvl: 13, prof: 5, reiatsu: 14, cero: '5d10', evos: 6 },
                { lvl: 14, prof: 5, reiatsu: 15, cero: '6d10', evos: 6 },
                { lvl: 15, prof: 5, reiatsu: 16, cero: '6d10', evos: 7 },
                { lvl: 16, prof: 5, reiatsu: 17, cero: '6d10', evos: 7 },
                { lvl: 17, prof: 6, reiatsu: 18, cero: '7d10', evos: 7 },
                { lvl: 18, prof: 6, reiatsu: 19, cero: '8d10', evos: 8 },
                { lvl: 19, prof: 6, reiatsu: 20, cero: '8d10', evos: 8 },
                { lvl: 20, prof: 6, reiatsu: 25, cero: '10d10', evos: 8 }
            ],
            features: [
                { lvl: 1, name: "Hierro (Iron Skin)", desc: "AC = 10 + DEX + CON. Reaction to reduce damage (1d10+Lvl)." },
                { lvl: 1, name: "Bala", desc: "Bonus Action 1d6 Force ranged attack." },
                { lvl: 2, name: "Cero", desc: "Action: Fire blast (See chart for dmg)." },
                { lvl: 2, name: "Sonído", desc: "Bonus Action teleport (Cost 1 Reiatsu)." },
                { lvl: 5, name: "Extra Attack", desc: "Attack twice." },
                { lvl: 6, name: "High-Speed Regen", desc: "Heal using Reiatsu as Bonus Action." },
                { lvl: 11, name: "Resurrección", desc: "Enter True Form (Fly, Heal, Damage buff)." }
            ],
            subclasses: {
                "Destruction": [{lvl: 3, name: "Primal Scream", desc: "Roar to frighten enemies."}],
                "Nihilism": [{lvl: 3, name: "Emptiness", desc: "Immune to Charm, no eating/breathing."}],
                "Madness": [{lvl: 3, name: "Analysis", desc: "Learn enemy stats."}],
                "Sacrifice": [{lvl: 3, name: "Phantom Currents", desc: "Swim speed & Defense reaction."}],
                "Solitude": [{lvl: 3, name: "Cero Metralleta", desc: "Rapid fire Cero attacks."}],
                "Time": [{lvl: 3, name: "Aura of Age", desc: "Slow enemies near you."}]
            },
            // Custom Logic for Arrancar Evolutions
            customOptions: "evolutions" 
        }
        // FUTURE CLASSES GO HERE
    };

    const EVOLUTIONS = [
        {name: "Bala Barrage", tier: 1}, {name: "Acidic Touch", tier: 1}, {name: "Pesquisa Radar", tier: 1},
        {name: "Hierro Armor (Resist)", tier: 5}, {name: "Cero Doble", tier: 5}, {name: "Garganta", tier: 5},
        {name: "Gran Rey Cero", tier: 9}, {name: "Los Lobos", tier: 9}, 
        {name: "Indestructible", tier: 15}, {name: "Respira", tier: 15}
    ];

    const STATS = ["STR", "DEX", "CON", "INT", "WIS", "CHA"];
    const SKILLS = {
        "Acrobatics": "DEX", "Animal Handling": "WIS", "Arcana": "INT", "Athletics": "STR",
        "Deception": "CHA", "History": "INT", "Insight": "WIS", "Intimidation": "CHA",
        "Investigation": "INT", "Medicine": "WIS", "Nature": "INT", "Perception": "WIS",
        "Performance": "CHA", "Persuasion": "CHA", "Religion": "INT", "Sleight of Hand": "DEX",
        "Stealth": "DEX", "Survival": "WIS"
    };

    /* =========================================
       LOGIC ENGINE
       ========================================= */
    
    // Init
    window.onload = function() {
        populateSelect('race', Object.keys(RACES));
        populateSelect('charClass', Object.keys(CLASSES));
        
        // Generate Stat Inputs
        const statContainer = document.getElementById('statsInputs');
        STATS.forEach(stat => {
            statContainer.innerHTML += `
                <div class="stat-row">
                    <label>${stat}</label>
                    <input type="number" id="val-${stat}" value="${stat === 'DEX' || stat === 'CON' ? 16 : 10}" oninput="render()">
                </div>`;
        });

        // Generate Save Inputs
        const saveContainer = document.getElementById('saveInputs');
        STATS.forEach(stat => {
            saveContainer.innerHTML += `
                <div class="skill-item">
                    <input type="checkbox" id="save-${stat}" onchange="render()">
                    <label>${stat}</label>
                </div>`;
        });

        // Generate Skill Inputs
        const skillContainer = document.getElementById('skillInputs');
        for (const [skill, stat] of Object.entries(SKILLS)) {
            skillContainer.innerHTML += `
                <div class="skill-item">
                    <input type="checkbox" id="skill-${skill.replace(/ /g,'')}" onchange="render()">
                    <label>${skill} (${stat})</label>
                </div>`;
        }

        // Generate Evolutions (Specific to Arrancar, but we load them hiddenly)
        const evoContainer = document.getElementById('evoList');
        EVOLUTIONS.forEach(evo => {
            evoContainer.innerHTML += `
                <div class="skill-item">
                    <input type="checkbox" class="evo-check" value="${evo.name}" data-tier="${evo.tier}" onchange="render()">
                    <label>${evo.name} (Lvl ${evo.tier})</label>
                </div>`;
        });

        changeClass(); // Trigger initial class load
    };

    function populateSelect(id, options) {
        const sel = document.getElementById(id);
        sel.innerHTML = "";
        options.forEach(opt => {
            const el = document.createElement('option');
            el.value = opt;
            el.innerText = opt;
            sel.appendChild(el);
        });
    }

    function changeClass() {
        const cName = document.getElementById('charClass').value;
        const cls = CLASSES[cName];
        
        // Populate Subclasses
        populateSelect('subclass', Object.keys(cls.subclasses));
        
        // Show/Hide Custom Options
        const evoSection = document.getElementById('classSpecificOptions');
        evoSection.style.display = (cls.customOptions === "evolutions") ? "block" : "none";

        // Auto-check Saving Throws based on Class
        STATS.forEach(s => document.getElementById(`save-${s}`).checked = false);
        cls.saves.forEach(s => document.getElementById(`save-${s}`).checked = true);

        render();
    }

    function getMod(score) { return Math.floor((score - 10) / 2); }
    function fmtSign(n) { return n >= 0 ? "+" + n : n; }

    function render() {
        // 1. Gather Basic Data
        const name = document.getElementById('name').value;
        const raceName = document.getElementById('race').value;
        const className = document.getElementById('charClass').value;
        const subclassName = document.getElementById('subclass').value;
        const level = parseInt(document.getElementById('level').value);

        const raceData = RACES[raceName];
        const classData = CLASSES[className];
        const classLevelData = classData.scaling[level - 1] || classData.scaling[19];
        const profBonus = classLevelData.prof;

        // 2. Render Header
        document.getElementById('sheetName').innerText = name;
        document.getElementById('sheetRaceClass').innerText = `${raceName} ${className}`;
        document.getElementById('sheetSubclass').innerText = subclassName;
        document.getElementById('sheetLevel').innerText = level;
        document.getElementById('sheetProf').innerText = fmtSign(profBonus);
        document.getElementById('sheetSpeed').innerText = raceData.speed + " ft";
        document.getElementById('sheetHD').innerText = `${level}d${classData.hd}`;

        // 3. Stats & Mods
        const stats = {};
        let statsHTML = "";
        
        STATS.forEach(stat => {
            const raw = parseInt(document.getElementById(`val-${stat}`).value);
            const mod = getMod(raw);
            stats[stat] = { val: raw, mod: mod };
            
            statsHTML += `
                <div class="attr-box">
                    <span class="attr-label">${stat}</span>
                    <span class="attr-mod">${fmtSign(mod)}</span>
                    <span class="attr-score">${raw}</span>
                </div>
            `;
        });
        document.getElementById('sheetStats').innerHTML = statsHTML;

        // 4. Derived Vitals
        // AC Logic: Check for Hierro (Arrancar)
        let ac = 10 + stats.DEX.mod;
        if (className === "Arrancar") {
            ac = 10 + stats.DEX.mod + stats.CON.mod; // Hierro
        }
        document.getElementById('sheetAC').innerText = ac;
        document.getElementById('sheetInit').innerText = fmtSign(stats.DEX.mod);
        
        // HP Logic
        const hp = classData.hd + stats.CON.mod + ((level - 1) * ((classData.hd/2 + 1) + stats.CON.mod));
        document.getElementById('sheetHP').innerText = Math.max(level, hp); // Minimum 1hp per level

        // Passive Perception
        const wisMod = stats.WIS.mod;
        const perProf = document.getElementById('skill-Perception').checked ? profBonus : 0;
        document.getElementById('sheetPP').innerText = 10 + wisMod + perProf;

        // 5. Saves & Skills
        let savesHTML = "";
        STATS.forEach(stat => {
            const isProf = document.getElementById(`save-${stat}`).checked;
            const total = stats[stat].mod + (isProf ? profBonus : 0);
            savesHTML += `
                <div class="prof-row ${isProf ? 'checked' : ''}">
                    <span>${isProf ? '●' : '○'}</span>
                    <span>${stat}</span>
                    <span>${fmtSign(total)}</span>
                </div>
            `;
        });
        document.getElementById('sheetSaves').innerHTML = savesHTML;

        let skillsHTML = "";
        for (const [skill, statKey] of Object.entries(SKILLS)) {
            const isProf = document.getElementById(`skill-${skill.replace(/ /g,'')}`).checked;
            const total = stats[statKey].mod + (isProf ? profBonus : 0);
            skillsHTML += `
                <div class="prof-row ${isProf ? 'checked' : ''}">
                    <span>${isProf ? '●' : '○'}</span>
                    <span>${skill} <small>(${statKey})</small></span>
                    <span>${fmtSign(total)}</span>
                </div>
            `;
        }
        document.getElementById('sheetSkills').innerHTML = skillsHTML;

        // 6. Class Resources (Reiatsu)
        if (className === "Arrancar") {
            document.getElementById('sheetResourceName').innerText = `Reiatsu (Cero: ${classLevelData.cero})`;
            document.getElementById('sheetResourceVal').innerText = classLevelData.reiatsu;
        }

        // 7. Features List
        let featHTML = "";
        
        // Core Class Features
        classData.features.forEach(feat => {
            if (feat.lvl <= level) {
                featHTML += `
                    <div class="feature-item">
                        <div class="feature-title">${feat.name}</div>
                        <div class="feature-meta">Class Feature (Lvl ${feat.lvl})</div>
                        <div class="feature-desc">${feat.desc}</div>
                    </div>`;
            }
        });

        // Subclass Features
        if (classData.subclasses[subclassName]) {
            classData.subclasses[subclassName].forEach(feat => {
                if (feat.lvl <= level) {
                    featHTML += `
                        <div class="feature-item">
                            <div class="feature-title">${feat.name}</div>
                            <div class="feature-meta">${subclassName} Feature (Lvl ${feat.lvl})</div>
                            <div class="feature-desc">${feat.desc}</div>
                        </div>`;
                }
            });
        }

        // Evolutions (Arrancar Specific)
        if (className === "Arrancar") {
            const evos = document.querySelectorAll('.evo-check:checked');
            evos.forEach(box => {
                featHTML += `
                    <div class="feature-item">
                        <div class="feature-title" style="color:var(--accent-glow)">${box.value}</div>
                        <div class="feature-meta">Hollow Evolution</div>
                    </div>`;
            });
        }
        
        // Race Traits
        raceData.traits.forEach(trait => {
             featHTML += `
                    <div class="feature-item">
                        <div class="feature-title">${trait.split(':')[0]}</div>
                        <div class="feature-meta">Racial Trait</div>
                        <div class="feature-desc">${trait.split(':')[1] || ''}</div>
                    </div>`;
        });

        document.getElementById('sheetFeatures').innerHTML = featHTML;
    }
</script>

</body>
</html>
